<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition xmlns:fn="http://java.sun.com/jsp/jstl/functions" template="/WEB-INF/templates/form_template.xhtml">  
    <ui:define name="head"> 
      <title>#{messages.LABEL_LISTA_IMPRESSAO_LAUDOS_PATOLOGICOS}</title> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{listaImpressaoLaudosController.iniciar}"/> 
      </f:metadata> 
    </ui:define>  
    
    <ui:define name="body"> 
      <mec:pageConfig controller="#{listaImpressaoLaudosController}"/>  
      <h:form prependId="false" id="formImpressaoLaudosPatologicos"> 
        <p:outputPanel id="panelFiltros" layout="inline" styleClass="aghu-panel-geral"> 
          <aghu:panelGeral legend="#{messages.LABEL_PESQUISAR_LISTA_PARA_IMPRESSAO_LAUDOS_EXAME_PATOLOGIA}"> 
            <aghu:panelGeral>
            <aghu:linha> 
              <mec:suggestionBox id="residenteResp" 
                                 label="#{messages.LABEL_RESIDENTE_RESPONSAVEL}" 
                                 title="#{messages.TITLE_RESIDENTE_RESPONSAVEL}" 
                                 suggestionAction="pesquisarResidenteResponsavel" 
                                 width="500" maxlength="200" block="true" 
                                 descricaoInput="servidor.id.matricula" 
                                 descricaoLabel="nome" 
                                 readonly="#{listaImpressaoLaudosController.numeroAp != null}" 
                                 controller="#{listaImpressaoLaudosController}" 
                                 value="#{listaImpressaoLaudosController.residenteResp}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_MATRICULA}</b> 
                  </f:facet> #{item.servidor.id.matricula}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_VINCULO}</b> 
                  </f:facet> #{item.servidor.id.vinCodigo}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_NOME}</b> 
                  </f:facet> #{item.nome}
                </p:column> 
              </mec:suggestionBox>  
              <mec:suggestionBox id="medicoSolic" 
                                 label="#{messages.LABEL_MEDICO_SOLICITANTE}" 
                                 title="#{messages.TITLE_MEDICO_SOLICITANTE}" 
                                 suggestionAction="pesquisarMedicosSolicitantesVO" 
                                 width="600" maxlength="200" block="true" 
                                 descricaoInput="matricula" 
                                 descricaoLabel="nome" 
                                 readonly="#{listaImpressaoLaudosController.numeroAp != null}" 
                                 controller="#{listaImpressaoLaudosController}" 
                                 value="#{listaImpressaoLaudosController.medicoSolic}"
                                 var="_itemMedSolic"
                                 itemValue="#{_itemMedSolic}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_MATRICULA}</b> 
                  </f:facet> #{_itemMedSolic.matricula}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_VINCULO}</b> 
                  </f:facet> #{_itemMedSolic.vinCodigo}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_NOME}</b> 
                  </f:facet> #{_itemMedSolic.nome}
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:suggestionBox id="patologistaResp" 
                                 label="#{messages.LABEL_PATOLOGISTA_RESPONSAVEL}" 
                                 title="#{messages.TITLE_PATOLOGISTA_RESPONSAVEL}" 
                                 suggestionAction="pesquisarPatologistaResponsavel" 
                                 width="500" maxlength="200" block="true"  
                                 descricaoInput="servidor.id.matricula" 
                                 descricaoLabel="nome" 
                                 readonly="#{listaImpressaoLaudosController.consultaExata}"                                  
                                 controller="#{listaImpressaoLaudosController}" 
                                 value="#{listaImpressaoLaudosController.patologistaResp}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_MATRICULA}</b> 
                  </f:facet> #{item.servidor.id.matricula}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_VINCULO}</b> 
                  </f:facet> #{item.servidor.id.vinCodigo}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_NOME}</b> 
                  </f:facet> #{item.nome}
                </p:column> 
              </mec:suggestionBox>  
              <mec:suggestionBox id="exame" label="#{messages.LABEL_EXAME_PATOLOGIA_CIRURGICA}" title="#{messages.TITLE_EXAME_PATOLOGIA_CIRURGICA}" suggestionAction="pesquisarAelConfigExLaudoUnico" width="500" descricaoInput="sigla" descricaoLabel="nome" maxlength="200" block="true" posSelectionAction="pesquisarRegistroUnico" posDeleteAction="pesquisarRegistroUnico" controller="#{listaImpressaoLaudosController}" value="#{listaImpressaoLaudosController.exame}" render="panelFiltros,panelResultados"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_SIGLA}</b> 
                  </f:facet> #{item.sigla}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_NOME}</b> 
                  </f:facet> #{item.nome}
                </p:column> 
              </mec:suggestionBox>  
              <mec:inputText id="numeroAp" label="#{messages.LABEL_NUMERO_EXAME_PATOLOGIA_CIRURGICA}" title="#{messages.TITLE_NUMERO_EXAME_PATOLOGIA_CIRURGICA}" size="10" maxlength="9" styleClass="mask_(999999/99)" value="#{listaImpressaoLaudosController.numeroAp}" converter="#{numeroApConverter}"> 
                <p:ajax event="change" update="@(#panelFiltros) @(#panelResultados)" process="@this" listener="#{listaImpressaoLaudosController.pesquisarRegistroUnico}"/> 
              </mec:inputText> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:selectOneMenu id="convenio" label="#{messages.LABEL_CONVENIO}" title="#{messages.TITLE_CONVENIO_PAT}" enum="DominioConvenioExameSituacao" value="#{listaImpressaoLaudosController.convenio}" readonly="#{listaImpressaoLaudosController.consultaExata}"/>  
              <mec:suggestionBox id="material" label="#{messages.LABEL_MATERIAL}" title="#{messages.TITLE_MATERIAL_EX_PAT}" suggestionAction="pesquisarAelExameApPorMateriais" width="900" descricaoInput="seq" descricaoLabel="materiais" readonly="#{listaImpressaoLaudosController.consultaExata}" maxlength="200" block="true" controller="#{listaImpressaoLaudosController}" value="#{listaImpressaoLaudosController.material}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_CODIGO}</b> 
                  </f:facet> #{item.seq}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_MATERIAL}</b> 
                  </f:facet> #{item.materiais}
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            </aghu:panelGeral>
            <aghu:linha> 
              <div> 
                <div style="float: left; width: 30%"> 
                  <aghu:panelGeral legend="#{messages.LABEL_PERIODO_REFERENCIA}"> 
                    <aghu:linha> 
                      <mec:inputTextData id="dtDe" value="#{listaImpressaoLaudosController.dtDe}" label="#{messages.LABEL_DE}" title="#{messages.TITLE_DE_REP}" required="#{not listaImpressaoLaudosController.consultaExata}" readonly="#{listaImpressaoLaudosController.consultaExata}" tipo="data"/>  
                      <mec:inputTextData id="dtAte" value="#{listaImpressaoLaudosController.dtAte}" label="#{messages.LABEL_ATE}" title="#{messages.TITLE_ATE_REP}" required="#{not listaImpressaoLaudosController.consultaExata}" readonly="#{listaImpressaoLaudosController.consultaExata}" tipo="data"/> 
                    </aghu:linha> 
                  </aghu:panelGeral> 
                </div>  
                <div style="float: left; width: 10%;"> 
                  <aghu:panelGeral legend="#{messages.LABEL_OUTRAS_OPCOES}"> 
                    <aghu:linha> 
                      <mec:selectOneMenu id="laudoImpresso" 
                                         enum="DominioSimNao" 
                                         label="#{messages.LABEL_IMPRESSO}" 
                                         title="#{messages.TITLE_LAUDO_IMPRESSO}" 
                                         readonly="#{listaImpressaoLaudosController.consultaExata}" 
                                         value="#{listaImpressaoLaudosController.laudoImpresso}" noSelectionOption="false"/> 
                    </aghu:linha> 
                  </aghu:panelGeral> 
                </div> 
              </div> 
            </aghu:linha> 
          </aghu:panelGeral>  
          <aghu:acao> 
            <mec:commandButton id="btnPesquisa" 
                               value="#{messages.LABEL_PESQUISAR}" 
                               block="true" 
                               action="#{listaImpressaoLaudosController.pesquisar}" 
                               styleClass="bt_cinza" 
                               render="panelResultados"
                               profile="search"/>  
            <mec:commandButton id="bt_limpar" 
                               value="#{messages.LABEL_LIMPAR}" 
                               action="#{listaImpressaoLaudosController.limpar}" 
                               immediate="true" styleClass="bt_cinza" 
                               profile="clear"/> 
          </aghu:acao> 
        </p:outputPanel> 
      </h:form>  
  		  <p:outputPanel id="panelResultados" layout="inline">
  		 <h:form prependId="false" id="formImpressaoLaudosPatologicosResultados"> 
          <p:outputPanel rendered="#{listaImpressaoLaudosController.dataModel.pesquisaAtiva}" layout="inline"> 
          <aghu:panelGeral legend="#{messages.LABEL_LISTA_PARA_IMPRESSAO_LAUDOS_EXAME_PATOLOGIA}"
                            rendered="#{listaImpressaoLaudosController.dataModel.pesquisaAtiva}" > 
                <mec:serverDataTable id="impressaoLaudosPatologicos"
                                     dataModel="dataModel" 
                                     value="#{listaImpressaoLaudosController}" 
                                     rendered="#{listaImpressaoLaudosController.dataModel.pesquisaAtiva}" 
                                     controller="#{listaImpressaoLaudosController}"> 
                  <c:set var="_item" value="#{item}"/>  
                  <p:column> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_ACAO}"/> 
                    </f:facet>  
                    <mec:commandLink id="btnVisualizarLaudo" 
                                     title="#{messages.LABEL_VISUALIZAR_LAUDO}" 
                                     rendered="#{mf:hasPermission(securityController,'visualizarLaudoAssinado,visualizar')}" 
                                     action="#{listaImpressaoLaudosController.visualizarRelatorio(_item.id.luxSeq,_item.id.nomePac)}" 
                                     styleClass="silk-magnifier silk-icon"> 
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.nroAps}" value="#{_item.id.lumNumeroAp},#{_item.nroVias}" for="command"/>  
                   	  <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.seqConfigExLaudoUnico}" value="#{_item.id.lu2Seq}" for="command"/> 	
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.isDirectPrint}" value="false" for="command"/>  
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.cameFrom}" value="exames-listaImpressaoLaudos" for="command"/> 
                    </mec:commandLink>  
                    <mec:commandLink id="btnImprimirLaudo" 
                                     title="#{messages.LABEL_IMPRIMIR_LAUDO}" 
                                     rendered="#{mf:hasPermission(securityController,'imprimirLaudoAssinado,imprimir')}" 
                                     action="#{listaImpressaoLaudosController.imprimirRelatorio(_item.id.luxSeq,_item.id.lumNumeroAp,_item.nroVias,_item.id.lu2Seq)}" 
                                     styleClass="silk-printer silk-icon"> 
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.nroAps}" value="#{_item.id.lumNumeroAp},#{_item.nroVias}" for="command"/>  
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.seqConfigExLaudoUnico}" value="#{_item.id.lu2Seq}" for="command"/>
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.isDirectPrint}" value="true" for="command"/>  
                      <f:setPropertyActionListener target="#{relatorioLaudoUnicoPdfController.cameFrom}" value="exames-listaImpressaoLaudos" for="command"/> 
                    </mec:commandLink> 
                  </p:column>  
                  <p:column sortBy="#{item[id.lumNumeroAp]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_NRO_EXAME}"/> 
                    </f:facet>  
                    <h:outputText value="#{_item.id.lumNumeroAp}"> 
                      <f:converter converterId="numeroApConverter"/> 
                    </h:outputText> 
                  </p:column>  
                  <p:column sortBy="#{item[id.dataExtrato]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_DT_ULT_MOV}"/> 
                    </f:facet>  
                    <h:outputText value="#{_item.id.dataExtrato}" isDate="true"> 
                      <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/> 
                    </h:outputText> 
                  </p:column>  
                  <p:column sortBy="#{item[id.nomePac]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_PACIENTE}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.id.nomePac != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block" rendered="#{(_item.id.nomePac.length() &gt; 19)}"> 
                        <h:outputText value="#{_item.id.nomePac}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{(_item.id.nomePac.length() &gt; 19) ? fn:substring(_item.id.nomePac,0,19) : _item.id.nomePac}"/>  
                      <h:outputText value="..." rendered="#{(_item.id.nomePac.length() &gt; 19)}"/> 
                    </p:outputPanel> 
                  </p:column>  
                  <p:column sortBy="#{item[id.lu2Nome]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_EXAME}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.id.lu2Nome != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block" rendered="#{(_item.id.lu2Nome.length() &gt; 15)}"> 
                        <h:outputText value="#{_item.id.lu2Nome}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{(_item.id.lu2Nome.length() &gt; 15) ? fn:substring(_item.id.lu2Nome,0,15) : _item.id.lu2Nome }"/>  
                      <h:outputText value="..." rendered="#{(_item.id.lu2Nome.length() &gt; 15)}"/> 
                    </p:outputPanel> 
                  </p:column>  
                  <p:column sortBy="#{item[id.luxMateriais]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_MATERIAL}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.id.luxMateriais != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block" rendered="#{(_item.id.luxMateriais.length() &gt; 19)}"> 
                        <h:outputText value="#{_item.id.luxMateriais}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{(_item.id.luxMateriais.length() &gt; 19) ? fn:substring(_item.id.luxMateriais,0,19) : _item.id.luxMateriais}"/>  
                      <h:outputText value="..." rendered="#{(_item.id.luxMateriais.length() &gt; 19)}"/> 
                    </p:outputPanel> 
                  </p:column>  
                  <p:column sortBy="#{item[id.luxIndImpresso]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_IMPR_EXAMES}"/> 
                    </f:facet>  
                    <h:outputText value="#{_item.id.luxIndImpresso ? 'Sim' : 'Não'}"/> 
                  </p:column>  
                  <p:column sortBy="#{item[convenio]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_CONV_EXAMES}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.convenio != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block"> 
                        <h:outputText value="#{_item.convenio}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{(_item.convenio.length() &gt; 10) ? fn:substring(_item.convenio,0,10) : _item.convenio}"/>  
                      <h:outputText value="..." rendered="#{(_item.convenio.length() &gt; 10)}"/> 
                    </p:outputPanel> 
                  </p:column>  
                  <p:column sortBy="#{item[id.matriculaMedicoSolic]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_MEDICO_SOLIC}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.id.nomeMedicoSolic != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block"> 
                        <h:outputText value="#{_item.id.nomeMedicoSolic}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{_item.id.matriculaMedicoSolic}"/> 
                    </p:outputPanel> 
                  </p:column>  
                  <p:column sortBy="#{item[id.matriculaResidente]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.LABEL_RESIDENTE}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.id.nomeResidente != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block"> 
                        <h:outputText value="#{_item.id.nomeResidente}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{_item.id.matriculaResidente}"/> 
                    </p:outputPanel> 
                  </p:column>  
                  <p:column sortBy="#{item[id.matriculaPatologista]}"> 
                    <f:facet name="header"> 
                      <h:outputText value="#{messages.AEL_02410}"/> 
                    </f:facet>  
                    <p:outputPanel rendered="#{_item.id.nomePatologista != null}" layout="inline"> 
                      <p:tooltip direction="bottom-right" styleClass="tooltip" layout="block"> 
                        <h:outputText value="#{_item.id.nomePatologista}"/> 
                      </p:tooltip>  
                      <h:outputText value="#{_item.id.matriculaPatologista}"/> 
                    </p:outputPanel> 
                  </p:column> 
                </mec:serverDataTable> 
          </aghu:panelGeral> 
         </p:outputPanel>  
  		</h:form> 
  	   </p:outputPanel> 	
    </ui:define> 
  </ui:composition> 
</html>
