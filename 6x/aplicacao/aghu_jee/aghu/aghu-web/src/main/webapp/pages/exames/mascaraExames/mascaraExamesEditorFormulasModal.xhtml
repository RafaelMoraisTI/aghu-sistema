<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition> 
    <p:outputPanel layout="inline" id="subPanelFormulasModal"> 
      <p:dialog id="modalFormula" width="900" height="505" modal="true" resizable="false" draggable="false" widgetVar="modalFormulaWG"> 
        <f:facet name="header"> 
          <h:outputText value="#{messages.LABEL_EDITOR_FORMULA}"/> 
        </f:facet>  
        <h:form prependId="false" id="formFormulas"> 
          <aghu:panelGeral style="width:850px;" legend="#{messages.LABEL_CAMPOS_DISPONIVEIS}"> 
            <aghu:linha> 
            	<p:outputPanel layout="block" style="width: 100%;">
               <mec:serverDataTable id="tblistaParamCpLaudo" 
               		list="#{manterMascaraExamesController.listaObjetosDigitados()}" 
               		scrollable="true"> 
                 <c:set var="item" value="#{item}"/>  
                 <p:column style="width:10%" rendered="#{manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}"> 
                   <f:facet name="header"> 
                     <h:outputText value="#{messages.LABEL_ACAO}"/> 
                   </f:facet>  
                   <mec:commandLink id="btMontaFormula"
                   		action="#{manterMascaraExamesController.montaFormula(item)}" 
                   		title="#{messages.LABEL_ADICIONAR}" 
                   		styleClass=" silk-accept silk-icon" 
                   		ajax="true" 
                   		render="panelExpressaoFormula"/> 
                 </p:column>  
                 <p:column> 
                   <f:facet name="header"> 
                     <h:outputText value="#{messages.LABEL_CAMPO_LAUDO}"/> 
                   </f:facet>  
                   <h:outputText value="#{item.campoLaudo.nome}#{item.id.seqp}"/> 
                 </p:column> 
               </mec:serverDataTable>
               </p:outputPanel> 
            </aghu:linha> 
          </aghu:panelGeral>  
          <table width="100%"> 
            <tr valign="top"> 
              <td width="95%" rowspan="1" colspan="1"> 
                <aghu:panelGeral legend="#{messages.LABEL_DADOS_PACIENTE} / #{messages.LABEL_FUNCOES}"> 
                  <aghu:linha style="text-align: center;"> 
                    <br clear="none"/>  
                    <mec:commandButton id="bt_idade" 
                    		value="#{messages.LABEL_IDADE}" 
                    		action="#{manterMascaraExamesController.montaFormula('idade')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/>         
                    <mec:commandButton id="bt_sexo" 
                    		value="#{messages.LABEL_SEXO}" 
                    		action="#{manterMascaraExamesController.montaFormula('sexo')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/> 
                    <mec:commandButton id="bt_power" 
                    		value="#{messages.LABEL_SIMBOLO_POWER}" 
                    		action="#{manterMascaraExamesController.montaFormula('power')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/>  
                    <mec:commandButton id="bt_raiz" 
                    		value="#{messages.LABEL_RAIZ}" 
                    		action="#{manterMascaraExamesController.montaFormula('raiz')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/>  
                    <mec:commandButton id="bt_decode" 
                    		value="#{messages.LABEL_DECODE}" 
                    		action="#{manterMascaraExamesController.montaFormula('decode')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/>  
                    <mec:commandButton id="bt_greatest" 
                    		value="#{messages.LABEL_GREATEST}" 
                    		action="#{manterMascaraExamesController.montaFormula('greatest')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/>  
                    <mec:commandButton id="bt_sign" 
                    		value="#{messages.LABEL_SIGN}" 
                    		action="#{manterMascaraExamesController.montaFormula('sign')}" 
                    		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                    		ajax="true" 
                    		render="panelExpressaoFormula" 
                    		styleClass="bt_cinza"/>  
                    <br clear="none"/>  
                    <br clear="none"/> 
                  </aghu:linha> 
                </aghu:panelGeral>  
                <aghu:panelGeral legend="#{messages.LABEL_EXPRESSAO}"> 
                  <aghu:linha> 
                    <p:outputPanel id="panelExpressaoFormula" layout="inline"> 
                      <mec:inputTextArea id="expressao" 
                      		rows="2" cols="90"
                      		value="#{manterMascaraExamesController.parametroSelect.textoLivre}" 
                      		readonly="#{not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                      		disabled="#{not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                      		maxlength="4000"/> 
                    </p:outputPanel> 
                  </aghu:linha> 
                </aghu:panelGeral> 
              </td>  
              <td width="1%" rowspan="1" colspan="1"/>  
              <td width="4%" align="center" valign="top" rowspan="2" colspan="1"> 
                 <aghu:panelGeral> 
                  <mec:commandButton id="bt_adicao" 
                  		value="+" 
                  		action="#{manterMascaraExamesController.montaFormula('adicao')}" 
                  		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                  		ajax="true" 
                  		render="panelExpressaoFormula" 
                  		styleClass="bt_cinza"/>  
                  <mec:commandButton id="bt_sub" 
                  		value="-" 
                  		action="#{manterMascaraExamesController.montaFormula('subtracao')}" 
                  		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                  		ajax="true" 
                  		render="panelExpressaoFormula" 
                  		styleClass="bt_cinza"/>  
                  <mec:commandButton id="bt_multi" 
                  		value="*" 
                  		action="#{manterMascaraExamesController.montaFormula('multiplicacao')}" 
                  		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                  		ajax="true" 
                  		render="panelExpressaoFormula" 
                  		styleClass="bt_cinza"/>  
                  <mec:commandButton id="bt_div" 
                  		value="/" 
                  		action="#{manterMascaraExamesController.montaFormula('divisao')}" 
                  		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                  		ajax="true" 
                  		render="panelExpressaoFormula" 
                  		styleClass="bt_cinza"/>  
                  <mec:commandButton id="bt_abre_parent" 
                  		value="(" 
                  		action="#{manterMascaraExamesController.montaFormula('abre_parenteses')}" 
                  		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                  		ajax="true" 
                  		render="panelExpressaoFormula" 
                  		styleClass="bt_cinza"/>  
                  <mec:commandButton id="bt_fecha_parent" 
                  		value=")" 
                  		action="#{manterMascaraExamesController.montaFormula('fecha_parenteses')}" 
                  		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
                  		ajax="true" 
                  		render="panelExpressaoFormula" 
                  		styleClass="bt_cinza"/> 
                </aghu:panelGeral>
              </td> 
            </tr> 
          </table>  
          <aghu:acao> 
            <mec:commandButton id="bt_gravar2" 
            		value="#{messages.LABEL_ADICIONAR}" 
            		action="#{manterMascaraExamesController.persistirFormula(true)}" 
            		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
            		profile="add" 
            		ajax="true" 
            		process="@this @(#expressao)"/>  
            <mec:commandButton id="bt_validar" 
            		value="Validar" 
            		action="#{manterMascaraExamesController.validaExpressao(false)}" 
            		disabled="#{not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
            		ajax="true"
            		process="@this @(#expressao)" 
            		render="subPanelFormulasResultModal" 
            		styleClass="bt_cinza" />  
            <mec:commandButton id="bt_limpar" 
            		value="#{messages.LABEL_LIMPAR}" 
            		action="#{manterMascaraExamesController.limpaCampoExpressao()}" 
            		disabled="#{not mf:hasPermission(securityController,'desenharMascara,executar') or not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
            		ajax="true" 
            		render="panelExpressaoFormula" 
            		styleClass="bt_cinza" 
            		profile="clear"/>  
            <mec:commandButton id="bt_fechar2" 
            		value="Fechar" 
            		onclick="PF('modalFormulaWG').hide();" 
            		rendered="#{mf:hasPermission(securityController,'desenharMascara,executar') and manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()}" 
            		profile="cancel"
            		process="@this" 
            		ajax="true" />  
            <mec:commandButton id="bt_fecharReadOnly" 
            		value="Fechar" 
            		rendered="#{(mf:hasPermission(securityController,'desenharMascara,executar') and not manterMascaraExamesController.versaoLaudo.situacao.isConstrucao()) 
            						or (not mf:hasPermission(securityController,'desenharMascara,executar') and manterMascaraExamesController.versaoLaudo.situacao.isConstrucao())}" 
            		onclick="PF('modalFormulaWG').hide();" 
            		profile="cancel" 
            		ajax="true" 
            		process="@this"/>  
          </aghu:acao> 
        </h:form> 
      </p:dialog>  
      <p:outputPanel id="subPanelFormulasResultModal" layout="inline"> 
        <p:dialog id="modalResultadoExpressao" width="460" height="500" modal="true" resizable="false" draggable="false" closable="false" widgetVar="modalResultadoExpressaoWG"> 
          <f:facet name="header"> 
            <h:panelGroup> 
              <h:outputText value="#{messages.LABEL_RESULADO_EXPRESSAO}"/> 
            </h:panelGroup> 
          </f:facet>  
          <h:form prependId="false" id="formResultExpressao"> 
            <h:panelGroup id="resultadoExp"> 
              <aghu:panelGeral legend="#{messages.LABEL_VARIAVEIS}" style="width:410px;"> 
                <aghu:linha> 
                    <mec:serverDataTable id="tabelaVariaveis" 
                    		list="#{manterMascaraExamesController.variaveisFormula}" 
                    		scrollable="true" 
                    		scrollHeight="250"> 
                      <c:set var="itemVar" value="#{item}"/>  
                      <p:column> 
                        <f:facet name="header"> 
                          <h:outputText value="#{messages.LABEL_VARIAVEL}"/> 
                        </f:facet> 
                        <h:outputText value="#{itemVar.variavel}"/> 
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <h:outputText value="#{messages.LABEL_VALOR}"/> 
                        </f:facet>
                        <pe:inputNumber id="variavel"
                        	value="#{itemVar.valorNumerico}"
                        	converter="#{bigDecimalConverter}"
                        	required="true"
                        	requiredMessage="Valor: Campo obrigatório, digite um valor."
                        	rendered="#{itemVar.variavel != 'SEXO'}"
                        	autocomplete="off"
                        	thousandSeparator=""
                        	decimalPlaces="#{itemVar.quantidadeCasasDecimais}">
	                      	<ui:insert/>
	                      	<f:attribute name="emptyStringToNull" value="#{mf:getDefaultValue(emptyStringToNull, false)}"/>
	                      	<f:attribute name="removerEspacosBrancos" value="#{mf:getDefaultValue(removerEspacosBrancos, true)}"/>
	                      	<f:attribute name="removerCaratersEspeciais" value="#{mf:getDefaultValue(removerCaratersEspeciais, true)}"/>
	                      	<p:ajax event="change" process="@this" listener="#{manterMascaraExamesController.atualizarValorVariavel(itemVar)}"/>
                    		</pe:inputNumber>
                    		
                    		<h:inputText id="variavelSexo"
                        	value="#{itemVar.valorSexo}"
                        	required="true"
                        	requiredMessage="Sexo: Campo obrigatório, digite um valor."
                        	rendered="#{itemVar.variavel == 'SEXO'}"
                        	maxlength="#{itemVar.quantidadeCaracteres}"
                        	autocomplete="off"
                        	style="text-transform:uppercase">
                        	<ui:insert/>
	                      	<f:attribute name="emptyStringToNull" value="#{mf:getDefaultValue(emptyStringToNull, false)}"/>
	                      	<f:attribute name="removerEspacosBrancos" value="#{mf:getDefaultValue(removerEspacosBrancos, true)}"/>
	                      	<f:attribute name="removerCaratersEspeciais" value="#{mf:getDefaultValue(removerCaratersEspeciais, true)}"/>
	                      	<p:ajax event="change" process="@this" listener="#{manterMascaraExamesController.atualizarValorVariavelSexo(itemVar)}"/>
                        </h:inputText>
                      </p:column> 
                    </mec:serverDataTable> 
                </aghu:linha> 
              </aghu:panelGeral>  
              <aghu:panelGeral legend="#{messages.LABEL_RESULTADO}" style="width:410px;"> 
                <aghu:linha> 
                  <mec:inputText id="campoResultado" 
                  		value="#{manterMascaraExamesController.resultadoValidacaoFormula}" 
                  		readonly="true" 
                  		style="text-transform:uppercase"/> 
                </aghu:linha> 
              </aghu:panelGeral> 
            </h:panelGroup>  
            <aghu:acao>
            	<mec:commandButton id="bt_validar_interno" 
            		value="Validar" 
            		action="#{manterMascaraExamesController.atualizarResultado()}" 
            		ajax="true"
            		process="@this" 
            		render="subPanelFormulasResultModal" 
            		styleClass="bt_cinza" />
             
              <mec:commandButton id="bt_fechar3" 
              		value="Fechar" 
              		onclick="PF('modalResultadoExpressaoWG').hide();"
              		profile="cancel"
              		styleClass="bt_fechar bt_cinza" 
              		ajax="true"/> 
            </aghu:acao> 
          </h:form> 
        </p:dialog> 
      </p:outputPanel> 
    </p:outputPanel> 
  </ui:composition> 
</html>