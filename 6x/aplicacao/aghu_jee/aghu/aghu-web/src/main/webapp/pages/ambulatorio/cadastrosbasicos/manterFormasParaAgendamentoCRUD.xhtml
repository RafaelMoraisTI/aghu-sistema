<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition template="/WEB-INF/templates/form_template.xhtml"> 
    <ui:define name="head"> 
      <title>#{messages.LABEL_CADASTRAR_FORMA_AGENDAMENTO} :: #{messages.NOME_ABREVIADO_PROJETO}</title> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{manterFormasParaAgendamentoController.inicio}"/> 
      </f:metadata> 
    </ui:define>  
    <ui:define name="body"> 
      <mec:pageConfig controller="#{manterFormasParaAgendamentoController}" ignoreEnter="true"/>  
      <p:outputPanel id="panelTela" layout="inline"> 
        <p:accordionPanel id="toggleFormaAgendamento" style="margin: 5px !important;" prependId="false"> 
          <p:tab title="#{messages.LABEL_FORMA_AGENDAMENTO}"> 
            <h:form prependId="false" id="cadastroFormaAgendamentoForm"> 
              <aghu:linha> 
                <aghu:linha> 
                  <mec:suggestionBox required="true" label="#{messages.LABEL_ORGAO_PAGADOR}" title="#{messages.TITLE_ORGAO_PAGADOR}" descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarPagadores" readonly="#{manterFormasParaAgendamentoController.edicao}" id="pagador" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.formaAgendamento.pagador}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_CODIGO}</b> 
                      </f:facet> #{item.seq}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_DESCRICAO}</b> 
                      </f:facet> #{item.descricao}
                    </p:column> 
                  </mec:suggestionBox>  
                  <mec:suggestionBox required="true" label="#{messages.LABEL_TIPO_AUTORIZACAO}" title="#{messages.TITLE_TIPO_AUTORIZACAO}" descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarTiposAgendamento" readonly="#{manterFormasParaAgendamentoController.edicao}" id="tipoAgendamento" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.formaAgendamento.tipoAgendamento}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_CODIGO}</b> 
                      </f:facet> #{item.seq}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_DESCRICAO}</b> 
                      </f:facet> #{item.descricao}
                    </p:column> 
                  </mec:suggestionBox>  
                  <mec:suggestionBox required="true" label="#{messages.LABEL_CONDICAO_ATENDIMENTO}" title="#{messages.TITLE_CONDICAO_ATENDIMENTO}" descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarCondicoesAtendimento" readonly="#{manterFormasParaAgendamentoController.edicao}" id="condicaoAtendimento" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.formaAgendamento.condicaoAtendimento}"> 
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_CODIGO}</b> 
                      </f:facet> #{item.seq}
                    </p:column>  
                    <p:column> 
                      <f:facet name="header"> 
                        <b>#{messages.LABEL_DESCRICAO}</b> 
                      </f:facet> #{item.descricao}
                    </p:column> 
                  </mec:suggestionBox> 
                </aghu:linha>  
                <aghu:linha> 
                  <mec:selectOneMenu label="#{messages.LABEL_ATENDIMENTO_ANTERIOR}" enum="DominioIndAtendimentoAnterior" title="#{messages.TITLE_ATENDIMENTO_ANTERIOR}" value="#{manterFormasParaAgendamentoController.formaAgendamento.atendimentoAnterior}" noSelectionOption="false" id="atendimentoAnterior"/>  
                  <mec:inputNumero size="5" maxlength="5" required="true" label="#{messages.LABEL_TEMPO_ANTERIOR}" title="#{messages.TITLE_TEMPO_ANTERIOR}" value="#{manterFormasParaAgendamentoController.formaAgendamento.tempoAnterior}" id="tempoAnterior"/>  
                  <mec:selectBooleanCheckbox label="#{messages.LABEL_EXIGE_PRONTUARIO}" title="#{messages.TITLE_EXIGE_PRONTUARIO}" value="#{manterFormasParaAgendamentoController.formaAgendamento.exigeProntuario}" id="exigeProntuarioCheckBox"/>  
                  <mec:selectBooleanCheckbox label="#{messages.LABEL_PERMITE_EXTRA}" title="#{messages.TITLE_PERMITE_EXTRA}" value="#{manterFormasParaAgendamentoController.formaAgendamento.permiteExtra}" id="permiteExtraCheckBox"/>  
                  <mec:selectBooleanCheckbox label="#{messages.LABEL_SENHA_AUTORIZADA}" title="#{messages.TITLE_SENHA_AUTORIZADA}" value="#{manterFormasParaAgendamentoController.formaAgendamento.senhaAutoriza}" id="senhaAutorizaCheckBox"/>  
                  <mec:selectBooleanCheckbox label="#{messages.LABEL_MESMA_GRADE}" title="#{messages.TITLE_MESMA_GRADE}" value="#{manterFormasParaAgendamentoController.formaAgendamento.mesmaGrade}" id="mesmaGradeCheckBox"/>  
                  <mec:selectBooleanCheckbox label="#{messages.LABEL_SMO}" title="#{messages.TITLE_SMO}" value="#{manterFormasParaAgendamentoController.formaAgendamento.exigeSmo}" id="exigeSmoCheckBox"/> 
                </aghu:linha>  
                <aghu:linha> 
                  <br clear="none"/> 
                </aghu:linha>  
                <aghu:linha> 
                  <mec:commandButton id="bt_salvar_forma_agendamento" value="#{messages.LABEL_GRAVAR}" action="#{manterFormasParaAgendamentoController.salvarFormaAgendamento}" profile="ok"/> 
                </aghu:linha> 
              </aghu:linha> 
            </h:form> 
          </p:tab> 
        </p:accordionPanel>  

        <p:outputPanel rendered="#{manterFormasParaAgendamentoController.edicao}" layout="inline"> 
          <p:accordionPanel id="toggleAtendimentoAnterior" name="toggleAtendimentoAnterior" style="margin: 5px !important;" prependId="false"> 
                    
            <p:tab title="#{messages.LABEL_BUSCA_ATENDIMENTO_ANTERIOR}"> 
              <p:outputPanel id="nivelBuscaPanel" layout="inline"> 
                <h:form id="formAtendimentoAnterior" prependId="false"> 
                  <aghu:linha> 
                    <mec:suggestionBox label="#{messages.LABEL_ORGAO_PAGADOR}" title="#{messages.TITLE_ORGAO_PAGADOR}" descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarPagadores" required="true" id="pagadorNivelBusca" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.nivelBusca.pagador}"> 
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_CODIGO}</b> 
                        </f:facet> #{item.seq}
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_DESCRICAO}</b> 
                        </f:facet> #{item.descricao}
                      </p:column> 
                    </mec:suggestionBox>  
                    <mec:suggestionBox label="#{messages.LABEL_TIPO_AUTORIZACAO}" title="#{messages.TITLE_TIPO_AUTORIZACAO}" descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarTiposAgendamento" required="true" id="tipoAgendamentoNivelBusca" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.nivelBusca.tipoAgendamento}"> 
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_CODIGO}</b> 
                        </f:facet> #{item.seq}
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_DESCRICAO}</b> 
                        </f:facet> #{item.descricao}
                      </p:column> 
                    </mec:suggestionBox> 
                  </aghu:linha>  
                  <aghu:linha> 
                    <mec:suggestionBox label="#{messages.LABEL_CONDICAO_ATENDIMENTO}" title="#{messages.TITLE_CONDICAO_ATENDIMENTO}" descricaoInput="seq" descricaoLabel="descricao" suggestionAction="pesquisarCondicoesAtendimento" required="true" id="condicaoAtendimentoNivelBusca" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.nivelBusca.condicaoAtendimento}"> 
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_CODIGO}</b> 
                        </f:facet> #{item.seq}
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_DESCRICAO}</b> 
                        </f:facet> #{item.descricao}
                      </p:column> 
                    </mec:suggestionBox>  
                    <mec:suggestionBox label="#{messages.LABEL_CLINICA}" title="#{messages.TITLE_CLINICA}" width="500" descricaoInput="codigo" descricaoLabel="descricao" suggestionAction="pesquisarClinicas" id="clinica" controller="#{manterFormasParaAgendamentoController}" value="#{manterFormasParaAgendamentoController.nivelBusca.clinica}"> 
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_CODIGO}</b> 
                        </f:facet> #{item.codigo}
                      </p:column>  
                      <p:column> 
                        <f:facet name="header"> 
                          <b>#{messages.LABEL_DESCRICAO}</b> 
                        </f:facet> #{item.descricao}
                      </p:column> 
                    </mec:suggestionBox>  
                    <br clear="none"/>  
                    <mec:commandButton id="bt_alterar_nivel_busca" style="float:left!important;" value="#{messages.LABEL_ALTERAR}" rendered="#{manterFormasParaAgendamentoController.edicaoNivelBusca}" action="#{manterFormasParaAgendamentoController.alterarNivelBusca}" profile="ok" styleClass="  alinha-direita" ajax="true" render="nivelBuscaPanel, lista_atd_ant_panel"/> 
					<mec:commandButton id="bt_cancelar_nivel_busca" style="float:left!important;"  value="#{messages.LABEL_CANCELAR_EDICAO}" status="commonstatus" action="#{manterFormasParaAgendamentoController.limparEdicaoNivelBusca}" profile="cancel" ajax="true" rendered="#{manterFormasParaAgendamentoController.edicaoNivelBusca}" render="nivelBuscaPanel, lista_atd_ant_panel" process="@this"/> 
                  </aghu:linha>  
                  <aghu:linha> 
                    <mec:commandButton id="bt_salvar_nivel_busca" value="#{messages.LABEL_GRAVAR}" rendered="#{!manterFormasParaAgendamentoController.edicaoNivelBusca}" action="#{manterFormasParaAgendamentoController.salvarNivelBusca}" profile="ok" ajax="true" render="nivelBuscaPanel, lista_atd_ant_panel"/> 
                  </aghu:linha> 
                </h:form> 
              </p:outputPanel>  
              
              <p:outputPanel id="lista_atd_ant_panel" layout="inline"> 
                <h:form id="formListaAtendimentosAnteriores" prependId="false"> 
                  <p:outputPanel id="lista_atds" rendered="#{not empty manterFormasParaAgendamentoController.niveisBuscas}" layout="inline"> 
                    <aghu:linha> 
                      <mec:serverDataTable rendered="#{not empty manterFormasParaAgendamentoController.niveisBuscas}" list="#{manterFormasParaAgendamentoController.niveisBuscas}" scrollable="true"> 
                        <c:set var="_item" value="#{item}"/>  
                        <p:column style="width:60px; #{(_item.id == manterFormasParaAgendamentoController.idNivelBusca) ? 'background-color: #EEE8AA' : ''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_ACOES}"/> 
                          </f:facet>  
                          <mec:commandLink rendered="#{_item.id == manterFormasParaAgendamentoController.idNivelBusca}" onclick="return false;" styleClass=" silk-blank silk-icon" ajax="true"/>
						<mec:commandLink
							action="#{manterFormasParaAgendamentoController.editarNivelBusca(_item.id)}"
							title="#{messages.LABEL_EDITAR}"
							rendered="#{_item.id != manterFormasParaAgendamentoController.idNivelBusca}"
							profile="edit" ajax="true"
							render="nivelBuscaPanel, lista_atd_ant_panel"
							process="@this" />
						<mec:commandLink title="#{messages.LABEL_EXCLUIR}"
								action="#{manterFormasParaAgendamentoController.excluirNivelBusca}"
								profile="delete" ajax="true" render="lista_atd_ant_panel" process="@this">
								<f:setPropertyActionListener target="#{manterFormasParaAgendamentoController.seqp}" value="#{_item.id.seqp}" for="command"/>
						  </mec:commandLink>
						</p:column>  
                        <p:column width="auto" style="#{(_item.id == manterFormasParaAgendamentoController.idNivelBusca)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_ORGAO_PAGADOR}"/> 
                          </f:facet>  
                          <h:outputText value="#{_item.pagador.seq} - #{_item.pagador.descricao}"/> 
                        </p:column>  
                        <p:column width="auto" style="#{(_item.id == manterFormasParaAgendamentoController.idNivelBusca)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_TIPO_AUTORIZACAO}"/> 
                          </f:facet>  
                          <h:outputText value="#{_item.tipoAgendamento.seq} - #{_item.tipoAgendamento.descricao}"/> 
                        </p:column>  
                        <p:column width="auto" style="#{(_item.id == manterFormasParaAgendamentoController.idNivelBusca)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_CONDICAO_ATENDIMENTO}"/> 
                          </f:facet>  
                          <h:outputText value="#{_item.condicaoAtendimento.seq} - #{_item.condicaoAtendimento.descricao}"/> 
                        </p:column>  
                        <p:column width="auto" style="#{(_item.id == manterFormasParaAgendamentoController.idNivelBusca)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_CLINICA}"/> 
                          </f:facet>  
                          <h:outputText value="#{_item.clinica.codigo} - #{_item.clinica.descricao}"/> 
                        </p:column> 
                      </mec:serverDataTable> 
                    </aghu:linha> 
                  </p:outputPanel> 
                </h:form> 
              </p:outputPanel> 
            </p:tab> 
          </p:accordionPanel>  
          
          <p:accordionPanel id="toggleRestritoEspecAgenda" style="margin: 5px !important;" prependId="false"> 
            <p:tab title="#{messages.LABEL_RESTRITO_ESPEC_AGENDAS}"> 
              
              <p:outputPanel id="formaEspecialidadePanel" layout="inline"> 
                <h:form id="formFormaEspecialidade" prependId="false"> 
                  <aghu:linha>
                  
					<mec:suggestionBox
						id="especialidade"
						label="#{messages.LABEL_ESPECIALIDADE_AGENDA}"
						title="#{messages.TITLE_ESPECIALIDADE_ESPEC_AGENDA}"
						descricaoInput="seq" 
						descricaoLabel="nomeEspecialidade"
						suggestionAction="pesquisarEspecialidadesAgendas"
						readonly="#{manterFormasParaAgendamentoController.edicaoFormaEspecialidade}"
						required="true" 
						width="600" 
						controller="#{manterFormasParaAgendamentoController}"
						value="#{manterFormasParaAgendamentoController.formaEspecialidade.especialidade}">
						<p:column>
							<f:facet name="header">
								<b>#{messages.LABEL_CODIGO}</b>
							</f:facet> #{item.seq}
						</p:column>
						<p:column>
							<f:facet name="header">
								<b>#{messages.LABEL_SIGLA}</b>
							</f:facet> #{item.sigla}
	                 	</p:column>
						<p:column>
							<f:facet name="header">
								<b>#{messages.LABEL_DESCRICAO}</b>
							</f:facet> #{item.nomeEspecialidade}
	                 	</p:column>
					</mec:suggestionBox>
									
					<mec:inputTextData label="#{messages.LABEL_DATA_INICIO}" title="#{messages.TITLE_DATA_INICIO_ESPEC_AGENDA}" size="10" maxlength="10" value="#{manterFormasParaAgendamentoController.formaEspecialidade.dtInicio}" id="data_inicio" tipo="data"/>  
                    <mec:inputTextData label="#{messages.LABEL_DATA_FIM}" title="#{messages.TITLE_DATA_FIM_ESPEC_AGENDA}" size="10" maxlength="10" value="#{manterFormasParaAgendamentoController.formaEspecialidade.dtFinal}" id="data_fim" tipo="data"/>  
                    <br clear="none"/>  
                	<mec:commandButton id="bt_alterar_forma_especialidade" style="float:left!important;" value="#{messages.LABEL_ALTERAR}" rendered="#{manterFormasParaAgendamentoController.edicaoFormaEspecialidade}" action="#{manterFormasParaAgendamentoController.alterarFormaEspecialidade}" profile="ok" styleClass="  alinha-direita" ajax="true" render="formaEspecialidadePanel, lista_espec_panel"/>
					<mec:commandButton id="bt_cancelar_forma_especialidade"
						style="float:left!important;"
						value="#{messages.LABEL_CANCELAR_EDICAO}"
						status="commonstatus"
						action="#{manterFormasParaAgendamentoController.cancelarEdicaoFormaEspecialidade}"
						profile="cancel" ajax="true"
						rendered="#{manterFormasParaAgendamentoController.edicaoFormaEspecialidade}"
						render="formaEspecialidadePanel, lista_espec_panel"
						process="@this" />
				  </aghu:linha>  
                  <aghu:linha> 
                    <mec:commandButton id="bt_salvar_forma_especialidade" value="#{messages.LABEL_GRAVAR}" rendered="#{!manterFormasParaAgendamentoController.edicaoFormaEspecialidade}" action="#{manterFormasParaAgendamentoController.salvarFormaEspecialidade}" profile="ok" ajax="true" render="formaEspecialidadePanel, lista_espec_panel"/> 
                  </aghu:linha> 
                </h:form> 
              </p:outputPanel>  

              <p:outputPanel id="lista_espec_panel" layout="inline"> 
                <h:form id="formListaFormasEspecialidades" prependId="false"> 
                  <p:outputPanel id="lista_especs" rendered="#{not empty manterFormasParaAgendamentoController.formasEspecialidades}" layout="inline"> 
                    <aghu:linha> 
                      <p:dataTable id="tabelaEspecialidades" rendered="#{not empty manterFormasParaAgendamentoController.formasEspecialidades}" 
                      		var="_formaEspecialidade" value="#{manterFormasParaAgendamentoController.formasEspecialidades}" scrollable="true" scrollHeight="200">
                          
                        <p:column style="width:60px; #{(_formaEspecialidade.id == manterFormasParaAgendamentoController.idFormaEspecialidade) ? 'background-color: #EEE8AA' : ''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_ACOES}"/> 
                          </f:facet>  
                   			<mec:commandLink rendered="#{_formaEspecialidade.id == manterFormasParaAgendamentoController.idFormaEspecialidade}" onclick="return false;" styleClass=" silk-blank silk-icon" ajax="true"/>
							<mec:commandLink
								action="#{manterFormasParaAgendamentoController.editarFormaEspecialidade(_formaEspecialidade.id)}"
								title="#{messages.LABEL_EDITAR}"
								rendered="#{_formaEspecialidade.id != manterFormasParaAgendamentoController.idFormaEspecialidade}"
								profile="edit" ajax="true"
								render="formaEspecialidadePanel, lista_espec_panel"
								process="@this" />
							<mec:commandLink title="#{messages.LABEL_EXCLUIR}"
								action="#{manterFormasParaAgendamentoController.excluirFormaEspecialidade}"
								profile="delete" ajax="true" render="lista_espec_panel" process="@this">
								<f:setPropertyActionListener target="#{manterFormasParaAgendamentoController.espSeq}" value="#{_formaEspecialidade.id.espSeq}" for="command"/>
						  </mec:commandLink>
					    </p:column> 
					     
                        <p:column width="auto" style="#{(_formaEspecialidade.id == manterFormasParaAgendamentoController.idFormaEspecialidade)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_ESPECIALIDADES_AGENDAS}"/> 
                          </f:facet>  
                          <h:outputText value="#{_formaEspecialidade.especialidade.seq} - #{_formaEspecialidade.especialidade.nomeEspecialidade}"/> 
                        </p:column>
                          
                        <p:column width="auto" style="#{(_formaEspecialidade.id == manterFormasParaAgendamentoController.idFormaEspecialidade)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_DATA_INICIO}"/> 
                          </f:facet>  
                          <h:outputText value="#{_formaEspecialidade.dtInicio}"> 
                            <f:convertDateTime pattern="dd/MM/yyyy"/> 
                          </h:outputText> 
                        </p:column>  
                        <p:column width="auto" style="#{(_formaEspecialidade.id == manterFormasParaAgendamentoController.idFormaEspecialidade)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_DATA_FINAL}"/> 
                          </f:facet>  
                          <h:outputText value="#{_formaEspecialidade.dtFinal}"> 
                            <f:convertDateTime pattern="dd/MM/yyyy"/> 
                          </h:outputText> 
                        </p:column>  
                        <p:column width="auto" style="#{(_formaEspecialidade.id == manterFormasParaAgendamentoController.idFormaEspecialidade)?'background-color:#EEE8AA':''}"> 
                          <f:facet name="header"> 
                            <h:outputText value="#{messages.LABEL_CRIADO_EM}"/> 
                          </f:facet>  
                          <h:outputText value="#{_formaEspecialidade.criadoEm}"> 
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/> 
                          </h:outputText> 
                        </p:column> 
                      </p:dataTable> 
                    </aghu:linha> 
                  </p:outputPanel> 
                </h:form> 
              </p:outputPanel> 
            </p:tab> 
          </p:accordionPanel> 
        </p:outputPanel>  
        <aghu:acao> 
          <h:form id="formBtnCancelar" prependId="false"> 
          	<mec:commandButton id="bt_cancelar" value="#{messages.LABEL_CANCELAR}" action="#{manterFormasParaAgendamentoController.cancelar}" profile="cancel" ajax="true"/> 
          </h:form> 
        </aghu:acao> 
      </p:outputPanel>  
    </ui:define> 
  </ui:composition> 
</html>
