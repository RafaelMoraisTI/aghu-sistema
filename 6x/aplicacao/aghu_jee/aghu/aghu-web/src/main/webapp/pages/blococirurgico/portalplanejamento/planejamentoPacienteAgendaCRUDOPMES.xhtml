<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition> 
  	<script type="text/javascript">
  	function bindInput(){ 
  		$('#tabelaListagemOpmes_data').on('keyup', 'input', function(event) {
	  	  if (event.which ==  40) {
	  	    var generico = $("#tabelaListagemOpmes_data").find('input:visible');
	  	    var indice = generico.index(event.target) + 1;
	  	    var seletor = $(generico[indice]).focus();
	
	  	    if (seletor.length == 0) {
	  	      event.target.focus();
	  	    }
	  	  }else if(event.which ==   38){
	  		var generico = $("#tabelaListagemOpmes_data").find('input:visible');
	  	    var indice = generico.index(event.target) - 1;
	  	    var seletor = $(generico[indice]).focus();
	
	  	    if (seletor.length == 0) {
	  	      event.target.focus();
	  	    }
		  }
	  	});
  	}
  	$('#tabelaListagemOpmes_data').on('keyup', 'input', function(event) {
	  	  if (event.which ==  40) {
	  	    var generico = $("#tabelaListagemOpmes_data").find('input:visible');
	  	    var indice = generico.index(event.target) + 1;
	  	    var seletor = $(generico[indice]).focus();
	
	  	    if (seletor.length == 0) {
	  	      event.target.focus();
	  	    }
	  	  }else if(event.which ==   38){
	  		var generico = $("#tabelaListagemOpmes_data").find('input:visible');
	  	    var indice = generico.index(event.target) - 1;
	  	    var seletor = $(generico[indice]).focus();
	
	  	    if (seletor.length == 0) {
	  	      event.target.focus();
	  	    }
		  }
	 });
		  	
  	</script>
    <style xml:space="preserve">
   		#suggestionMaterialOpmes:suggestionMaterialOpmes:suggestion_input{
			width:300px !important;
		}
		#suggestionMaterialOpmes:suggestionMaterialOpmes:sgText{
			width:300px !important;
		}
		.externaQtdeSolicitada{
			width:65px;
		    overflow: auto;
		    display: table;
		}
		.qtdeSolicitadaCampo {
			display: table-cell;
    		vertical-align: middle;
    		width: 30px;
		}
		.qtdeSolicitadaCampo input[type=text]{
			width: 30px;
			height: 27px;
		}
		.botoesQuantidades {
			float:left;
			width:10px;
			height:36px;
			margin-bottom:-5px;
			margin-top:1px;
		}
		
		.botoesQuantidades input[type=button]{
			background-color: #4a75b5;
			display: block;
    		vertical-align: middle;
            font-size:8px;
            width:20px;
            height:15px;
		}
		
		.botaoQuantidade1,  .botaoQuantidade2{
		}
		
		div#inputSituacaoProcessoAutorizacao label,
		div#inputTotalCompativel label,
		div#inputTotalIncompativel {
			margin: 3px 6px;
		}
		.botaoQuantidade1 span.ui-c{
			margin-left:-7px;
			margin-top:-3px;  
		}
		.botaoQuantidade2 span.ui-c{
			margin-left:-6px; 
			margin-top:-4px;  
		}
		#tabelaListagemOpmes_data  thead{ 
			display: none !important;
		}
		
		#tabelaListagemOpmes_data  td{ 
			padding:1px 6px 1px !important;
		}
		
		#tabelaListagemOpmes th{ 
			font-size:9px !important;
		} 
		#tabelaListagemOpmes td{ 
			font-size:9px !important;
		}
		#inputSituacaoProcessoAutorizacao{  
			margin-top:3px; !important;
		}
		#inputTotalCompativel{  
			margin-top:3px; !important;
		}
		#icon_grupo {
			border: none;
			width: 25%;
			padding: 20px;
			border-radius: 10px;
		}	
		
	</style>  
    <aghu:panelGeral style="margin-left:-10px !important;margin-right:-10px !important;"> 

      <p:outputPanel id="panelTab" layout="inline"> 
          <p:dataTable  id="tabelaListagemOpmes" 
	          name="tabelaListagemOpmes" 
	          value="#{cadastroPlanejamentoPacienteAgendaOPMESController.listaPesquisada}" 
	          var="_item" 
	          style="float:left !important;"> 
            <p:column style="width: 2%" headerText="#{messages.LABEL_ACAO}"> 
              <mec:commandLink id="deletar_opme" 
              	title="#{messages.LABEL_EXCLUIR}" 
              	rendered="#{empty _item.voQuebra}" 
              	action="#{cadastroPlanejamentoPacienteAgendaOPMESController.excluir(_item)}" 
              	profile="delete" 
              	ajax="true" 
              	render="outModalExcluirItemRequisicao, panelTab, outCampos,textAreaIncompatibilidade"
              	disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}"
              	readonly="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}" 
              	process="@this"/> 
            </p:column>  
            <p:column id="colCor" style="width: 3%; vertical-align: center;" headerText="Grupo"> 
				<div id="icon_grupo"  style="background-color: #{_item.cor.descricao} !important;"></div>
            </p:column>  
            <p:column id="colItemProcedimentoHospitalar" style="width: 15%" headerText="#{messages.LABEL_ITEM_PROCEDIMENTO_HOSPITALAR_SIGTAP}"> 
              <h:outputText value="#{_item.itemProcedimentoHospitalar}" rendered="#{empty _item.voQuebra}" id="colTextoItemProcedimentoHospitalar" title="#{_item.itemProcedimentoHospitalar}"/> 
            </p:column>  
            <p:column id="colQtdeAut" style="text-align:right; width: 5%" headerText="#{messages.LABEL_QTDE_AUT}"> 
              <h:outputText value="#{_item.qtdeAut}" id="colTextoQtdeAut" rendered="#{empty _item.voQuebra}"/> 
            </p:column>  
            <p:column id="colQtdeSol" style="text-align:right; width: 4%" headerText="#{messages.LABEL_QTDE_SOLICITADA_OPME}">  
              <h:outputText value="#{_item.qtdeSol}" id="colTextQtdeSol" rendered="#{empty _item.voQuebra}" style="#{_item.corQtdeSol}"/> 
            </p:column>  
            <p:column id="colValorunit" style="text-align:right; width: 6%" headerText="#{messages.LABEL_VALOR_SUS}">  
              <h:outputText value="#{_item.valorUnit}" id="colTextoValorUnit" rendered="#{empty _item.voQuebra}"> 
                <f:convertNumber pattern="#,##0.00"/> 
              </h:outputText> 
            </p:column>  
            <p:column id="colValorTotal" style="text-align:right; width: 3%" headerText="#{messages.LABEL_VLR_TOTAL}"> 
              <h:outputText value="#{_item.valorTotal}" id="colValorTotalText" rendered="#{empty _item.voQuebra}"> 
                <f:convertNumber pattern="#,##0.00"/> 
              </h:outputText> 
            </p:column>  
            
            <p:column id="colSel" style="width: 39%" rendered="#{empty _item.voQuebra}" headerText="Material Hospital"> 
             	<p:outputPanel id="panelLista2" layout="inline"> 
	             	<p:dataTable id="tabelaListagemOpmes2" 
		         		 name="tabelaListagemOpmes2"  
		          		 value="#{_item.filhos}" 
		          		 var="_filho"
		          		 style="width: 100% !important;">
		          		 
		          		  <p:column id="colSel1" style="width: 16%" > 
				                <div class="externaQtdeSolicitada"> 
				                  <div class="qtdeSolicitadaCampo"> 
				                    <h:inputText id="colSelecionado" 
				                    	label="#{messages.LABEL_TOTAL_COMPATIVEL}" 
				                    	style="text-align:right;" 
				                    	value="#{_filho.qtdeSolicitadaMaterial}"
				                    	disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}"> 
				                      <f:converter converterId="javax.faces.Integer"/>  
				                      <p:ajax event="change" listener="#{cadastroPlanejamentoPacienteAgendaOPMESController.alteraQuantidadeDigitada(_filho)}" update="@(#panelTab) @(#outCampos) @(#textAreaIncompatibilidade)" process="@this"/> 
				                    </h:inputText> 
				                  </div>  
				                  <div class="botoesQuantidades"> 
				                    <div class="botaoQuantidade1"> 
				                      <mec:commandButton id="btnSomaQuantidade" 
					                      value="+" 
					                      immediate="true" 
					                      action="#{cadastroPlanejamentoPacienteAgendaOPMESController.somaQuantidade(_filho)}" 
					                      ajax="true" 
					                      render="tabelaListagemOpmes,tabelaListagemOpmes2,outCampos,textAreaIncompatibilidade" 
					                      process="@this" 
					                      styleClass="bt_cinza" 
					                      style="width:16px !important;height:15px !important;"
					                      disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}"/> 
				                    </div>  
				                    <div class="botaoQuantidade2"> 
				                      <mec:commandButton id="btSubtraiQuantidade" 
					                      value="-" 
					                      immediate="true" 
					                      action="#{cadastroPlanejamentoPacienteAgendaOPMESController.subtraiQuantidade(_filho)}" 
					                      ajax="true" render="tabelaListagemOpmes,tabelaListagemOpmes2,outCampos,textAreaIncompatibilidade" 
					                      process="@this" styleClass="bt_cinza" 
					                      style="width:16px !important;height:15px !important;"
					                      disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}"/> 
				                    </div> 
				                  </div> 
				                </div> 
	            		</p:column>  
		          		<p:column id="colCodigo" style="width:62%;white-space:normal!important" >
		          			<h:outputText value="#{_filho.codigoEDescricao}" title="#{_filho.codigoEDescricao}"/>
		          		</p:column>
		          		<p:column id="colMaterialMarca" style="width: 14%" >
		          			<h:outputText value="#{_filho.descricaoMarcasComerciais}" title="#{_filho.descricaoMarcasComerciais}"/>
		          		</p:column>
		          		
		          	</p:dataTable>
		         </p:outputPanel>		  
            </p:column>  
            
            <p:column id="colSel2" style="width: 4%" rendered="#{empty _item.voQuebra}" headerText="Valor Licitado"> 
             	<p:outputPanel id="panelLista3" layout="inline"> 
	             	<p:dataTable id="tabelaListagemOpmes3" 
		         		 name="tabelaListagemOpmes3"  
		          		 value="#{_item.filhos}" 
		          		 var="_filho"
		          		 style="width: 100% !important;">
	
		          		<p:column id="colUnidadeMaterial2" style="height: 32px;">
		          			<h:outputText value="#{_filho.valorUnitario}" title="#{_filho.valorUnitario}"> 
	                			<f:convertNumber pattern="#,##0.00"/> 
	              			</h:outputText> 	
		          		</p:column>    
		          	</p:dataTable>	
	          	</p:outputPanel>  
            </p:column> 
            
          </p:dataTable> 
      </p:outputPanel>    
      <p:outputPanel id="outCampos" layout="inline"> 
        <aghu:linha> 
          <mec:inputText id="inputSituacaoProcessoAutorizacao"  size="34" label="#{messages.LABEL_SITUACAO_PROCESSO_AUTORIZACAO}" posicaoLabel="esquerda" readonly="true" value="#{cadastroPlanejamentoPacienteAgendaOPMESController.situacaoProcessoAutorizacao}"/>  
          <mec:inputNumero id="inputTotalCompativel" style="text-align:right;" fieldStyle="float:left" label="#{messages.LABEL_TOTAL_COMPATIVEL} R$: " posicaoLabel="esquerda" readonly="true" inteiros="12" decimais="2" value="#{cadastroPlanejamentoPacienteAgendaOPMESController.totalCompativel}"/>  
          <mec:inputNumero id="inputTotalIncompativel" readonly="true" style="text-align:right;" fieldStyle="float:left" label="#{messages.LABEL_TOTAL_INCOMPATIVEL} R$: " posicaoLabel="esquerda" inteiros="12" decimais="2" value="#{cadastroPlanejamentoPacienteAgendaOPMESController.totalIncompativel}"/> 
        </aghu:linha>
        
        <aghu:linha>
        		
        	 <p:commandButton id="bt_materiais_outros" 
        	 	value="#{messages.LABEL_BTN_OUTROS_MATERIAIS_NOVOS}" 
        	 	style="float:right !important;"
        	 	styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only button-acao bt_cinza bt_cinza"
            	oncomplete="PF('modalMateriaisWG').show();" 
            	immediate="true" 
            	title="#{messages.TITLE_BTN_OUTROS_MATERIAIS_NOVOS}"
            	ajax="true" process="@this" 
            	disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}" >
            </p:commandButton>
        	 <mec:commandButton id="bt_materiais_novos" 
        	 	value="#{messages.LABEL_BTN_MATERIAIS_FORA_CATALOGO}" 
        	 	style="float:right !important;"
            	action="#{cadastroPlanejamentoPacienteAgendaOPMESController.materiaisNovos}" 
            	oncomplete="PF('modalMateriaisNovosWG').show();" 
            	immediate="true" ajax="true" 
            	render="outtextAreaMateriaisNovos" process="@this" styleClass="bt_cinza"
            	disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala or cadastroPlanejamentoPacienteAgendaOPMESController.habilitarOutrosMateriais}" >
            </mec:commandButton>
            <mec:commandButton id="bt_observacao_opms" 
            					value="#{messages.LABEL_OBSERVACAO_OPMS}" 
            					action="#{cadastroPlanejamentoPacienteAgendaOPMESController.setEditarObservacao}" 
            					style="float:right !important;"
            					styleClass="bt_cinza"
            					oncomplete="PF('modalObservacaoWG').show();"
            					disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.desabilitaProcedimentoSus or cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}" 
            					process="@this"
            					immediate="true" 
            					ajax="true"/>  
        	
        	<mec:commandButton id="bt_editar_justificativa"
        						style="float:right !important;"
								styleClass="bt_secund icon-pencil" 
								value="#{messages.LABEL_EDITAR_JUSTIFICATIVA}"
								oncomplete="PF('modalJustificativaWG').show();"
								action="#{cadastroPlanejamentoPacienteAgendaOPMESController.editarJustificativas}" 
								rendered="#{cadastroPlanejamentoPacienteAgendaOPMESController.visualizarJustificativa}"
								disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.habilitarJustificativa}" 
								process="@this"/>
        </aghu:linha>
      
        <aghu:linha> 
          <mec:inputTextArea id="textAreaIncompatibilidade" cols="130" rows="4" label="#{messages.LABEL_INCOMPATIBILIDADES_ENCONTRADAS}" size="125" readonly="true" rendered="#{not empty cadastroPlanejamentoPacienteAgendaOPMESController.incompatibilidadesEncontrada}" value="#{cadastroPlanejamentoPacienteAgendaOPMESController.incompatibilidadesEncontrada}" removerCaratersEspeciais="false" maxlength="1000"/> 
        </aghu:linha> 
      </p:outputPanel>  
      <aghu:linha style="margin: 5px 0 6px"> 
        <mec:commandButton id="bt_cancelar_opmes" 
        	value="#{messages.LABEL_CANCELAR_OPMES}" 
        	action="#{cadastroPlanejamentoPacienteAgendaOPMESController.cancelarOpmes}" 
        	render="panelTab,tabelaListagemOpmes,outtextAreaMateriaisNovos, panelExibirModal, outCampos, outJustificativa, outObservacao" 
        	profile="cancel"
        	disabled="#{cadastroPlanejamentoPacienteAgendaOPMESController.procedimentoEmEscala}" /> 
      </aghu:linha> 
    </aghu:panelGeral>  
    
   
  </ui:composition> 
</html>
