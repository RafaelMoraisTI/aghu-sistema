<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition template="/WEB-INF/templates/form_template.xhtml"> 
    <ui:define name="head"> 
      <title>#{messages.TITLE_RESERVAR_LEITO}</title> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{reservaLeitoController.inicio}"/> 
      </f:metadata> 
    </ui:define>  
    <ui:define name="body"> 
      <mec:pageConfig controller="#{reservaLeitoController}"/>  
      <h:form prependId="false" id="formReservarLeito"> 
        <aghu:panelGeral id="ffdl_reservar" legend="#{messages.LABEL_RESERVAR_LEITO}"> 
          <aghu:linha> 
            <mec:suggestionBox id="suggestionLeitos" styleClassField="frm_obrigatorio" label="#{messages.LABEL_LEITO}" title="#{messages.TITLE_LABEL_LEITO}" descricaoInput="leitoID" size="10" maxlength="45" width="600" disabled="false" descricaoLabel="unidadeFuncional.LPADAndarAlaDescricao" suggestionAction="pesquisarLeitosDesocupados" controller="#{reservaLeitoController}" value="#{reservaLeitoController.leitos}" render="situacao"> 
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_LEITO}"/> 
                </f:facet>  
                <h:outputText value="#{item.leitoID}"/> 
              </p:column>  
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_ANDAR_ALA_UNIDADE}"/> 
                </f:facet>  
                <h:outputText value="#{item.unidadeFuncional.LPADAndarAlaDescricao}"/> 
              </p:column>  
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_SITUACAO_LEITO}"/> 
                </f:facet>  
                <h:outputText value="#{item.tipoMovimentoLeito.grupoMvtoLeito.descricao}"/> 
              </p:column> 
            </mec:suggestionBox> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:inputText id="situacao" label="#{messages.LABEL_SITUACAO_LEITO}" value="#{reservaLeitoController.leitos.tipoMovimentoLeito.grupoMvtoLeito.descricao}" readonly="true" styleclass="suggestion_input" style="text-transform:uppercase"/> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:inputNumero label="#{messages.LABEL_VINCULO}" title="#{messages.TITLE_LABEL_VINCULO_RESERVA}" maxlength="3" size="3" id="codigoResponsavel" readonly="true" value="#{reservaLeitoController.rapServidores.id.vinCodigo}"/>  
            <mec:suggestionBox id="suggestionResponsavel" styleClassField="frm_obrigatorio" label="#{messages.LABEL_MATRICULA}" title="#{messages.TITLE_MATRICULA_RESERVAR}" descricaoInput="id.matricula" size="10" maxlength="7" disabled="false" descricaoLabel="pessoaFisica.nome" suggestionAction="pesquisarResponsaveis" controller="#{reservaLeitoController}" value="#{reservaLeitoController.rapServidores}" render="codigoResponsavel"> 
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_VINCULO}"/> 
                </f:facet>  
                <h:outputText value="#{item.id.vinCodigo}"/> 
              </p:column>  
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_MATRICULA}"/> 
                </f:facet>  
                <h:outputText value="#{item.id.matricula}"/> 
              </p:column>  
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_NOME}"/> 
                </f:facet>  
                <h:outputText value="#{item.pessoaFisica.nome}"/> 
              </p:column> 
            </mec:suggestionBox> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:suggestionBox id="suggestionReserva" styleClassField="frm_obrigatorio" label="#{messages.LABEL_TIPO_RESERVA}" title="#{messages.TITLE_TIPO_RESERVA}" descricaoInput="codigo" size="10" maxlength="45" disabled="false" descricaoLabel="descricao" suggestionAction="pesquisarTipoReserva" controller="#{reservaLeitoController}" value="#{reservaLeitoController.tiposMovimentoLeito}"> 
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_CODIGO_RESERVA}"/> 
                </f:facet>  
                <h:outputText value="#{item.codigo}"/> 
              </p:column>  
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_DESCRICAO_RESERVA}"/> 
                </f:facet>  
                <h:outputText value="#{item.descricao}"/> 
              </p:column> 
            </mec:suggestionBox> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:suggestionBox id="suggestionOrigem" styleClassField="frm_obrigatorio" label="#{messages.LABEL_ORIGEM}" title="#{messages.TITLE_ORIGEM_RESERVA}" descricaoInput="seq" size="10" maxlength="45" disabled="false" descricaoLabel="descricao" suggestionAction="pesquisarOrigemEvento" controller="#{reservaLeitoController}" value="#{reservaLeitoController.origemEventos}"> 
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_CODIGO_ORIGEM}"/> 
                </f:facet>  
                <h:outputText value="#{item.seq}"/> 
              </p:column>  
              <p:column> 
                <f:facet name="header"> 
                  <h:outputText value="#{messages.LABEL_DESCRICAO_ORIGEM}"/> 
                </f:facet>  
                <h:outputText value="#{item.descricao}"/> 
              </p:column> 
            </mec:suggestionBox> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:inputTextProntuario label="#{messages.LABEL_PRONTUARIO}" id="codigoProntuario" size="10" maxlength="9" title="#{messages.TITLE_PRONTUARIO_RESERVA}" value="#{reservaLeitoController.codigoProntuario}"> 
              <p:ajax event="blur" update="@(#codigoProntuario) @(#nomePaciente)" process="@this" listener="#{reservaLeitoController.obterPacientePorProntuario()}"/> 
            </mec:inputTextProntuario>  
            <mec:inputText label="#{messages.LABEL_NOME_PACIENTE_RESERVA}" id="nomePaciente" size="75" maxlength="50" ajaxValidation="false" style="text-transform:uppercase" value="#{reservaLeitoController.paciente.nome}" readonly="true"/> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:inputTextData id="dataLancamento" value="#{reservaLeitoController.dataLancamento}" label="#{messages.LABEL_DATA_LANCAMENTO}" title="#{messages.TITLE_DATA_LANCAMENTO_RESERVA}" size="15" required="true" tipo="datahora"/> 
          </aghu:linha>  
          <aghu:linha> 
            <mec:inputTextArea label="#{messages.LABEL_JUSTIFICATIVA}" title="#{messages.TITLE_JUSTIFICATIVA_RESERVA}" cols="50" rows="4" value="#{reservaLeitoController.justificativa}" id="justificativa" maxlength="240"/> 
          </aghu:linha> 
        </aghu:panelGeral>  
        <aghu:acao> 
		  <mec:commandButton value="#{messages.LABEL_RESERVAR}" id="bt_etiq" action="#{reservaLeitoController.validarDados}" render="formReservarLeito, openModal" profile="ok" ajax="true"/>  
          <mec:commandButton id="bt_limparPesquisa" value="#{messages.LABEL_LIMPAR}" action="#{reservaLeitoController.limparPesquisa}" styleClass="bt_cinza" profile="clear"/>  
          <mec:commandButton id="cancelar" immediate="true" value="#{messages.LABEL_CANCELAR}" rendered="#{not empty reservaLeitoController.voltarPara}" action="#{reservaLeitoController.cancelar}" profile="cancel"/> 
        </aghu:acao> 
      </h:form>  
      <p:outputPanel id="openModal" layout="inline"> 
      	<p:dialog id="modal" showWhenRendered="true" rendered="#{reservaLeitoController.validado}" width="400" height="150" modal="true" resizable="false" widgetVar="modalWG"> 
        	<f:facet name="header"> 
          	<h:outputText value="#{messages.LABEL_RESERVAR_LEITO}"/> 
        	</f:facet> #{messages.MENSAGEM_CONFIRMA_RESERVA} 
        	<br clear="none"/>  
        	<br clear="none"/>  
        	<br clear="none"/>  
        	<h:panelGroup> 
          	 <h:form prependId="false" id="formModalReserva"> 
            	<mec:commandButton value="#{messages.LABEL_SIM}" id="bt_confirma" oncomplete="PF('modalWG').hide();" action="#{reservaLeitoController.reservar}" profile="ok" ajax="true" disabled="#{mf:hasPermission(securityController, 'internacao,somenteLeitura')}" render="formReservarLeito"/>  
            	<mec:commandButton value="#{messages.LABEL_NAO}" oncomplete="PF('modalWG').hide();" action="#{reservaLeitoController.cancelar}" profile="cancel" ajax="true"/> 
          	 </h:form> 
        	</h:panelGroup> 
      	</p:dialog> 
      </p:outputPanel>	
    </ui:define> 
  </ui:composition> 
</html>
