<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition template="/WEB-INF/templates/form_template.xhtml"> 
    <ui:define name="head"> 
      <title>#{messages['TITLE_LIBERAR_PARCELAS_AF']} :: #{messages['NOME_ABREVIADO_PROJETO']}</title> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{pesquisaProgrEntregaItensAFController.iniciar}"/> 
      </f:metadata> 
    </ui:define>  
    <ui:define name="body"> 
      <mec:pageConfig controller="#{pesquisaProgrEntregaItensAFController}"/>  
        <h:form prependId="false" id="pesquisaFrm"> 
          <aghu:panelGeral legend="#{messages.TITLE_LIBERAR_PARCELAS_AF}"> 
            <aghu:linha> 
              <mec:inputNumero id="numeroAf" label="#{messages.LABEL_CONS_NUMERO_AF}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.numeroProposta}" size="10" maxlength="6"/>  
              <mec:inputNumero id="numeroComplemento" label="#{messages.LABEL_CONS_CP}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.numeroComplemento}" size="10" maxlength="6"/>  
              <mec:inputText id="fornecedor" label="#{messages.LABEL_SUGGESTION_FORNECEDOR_AF}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.fornecedor.razaoSocial}" size="80"/>  
              <mec:inputText id="modalidadeLicitacao" label="#{messages.LABEL_MODALIDADE_COMPRA_PARC_AF}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.modalidadeCompra.codigo}-#{pesquisaProgrEntregaItensAFController.modalidadeCompra.descricao}" size="30"/> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:inputNumero id="numeroItemAf" label="#{messages.LABEL_NUMERO_ITEM_AF}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.numeroItemLicitacao}" size="10"/>  
              <mec:inputText id="tipo" label="#{messages.LABEL_TIPO_ITEM_AF}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.tipoSolicitacao}" size="10"/>  
              <mec:inputText id="descricaoSolicitacao" label="#{messages.LABEL_DESCRICAO}" readonly="true" value="#{pesquisaProgrEntregaItensAFController.descricaoSolicitacao}" size="70"/>  
              <mec:inputNumero id="qtdeAf" label="#{messages.LABEL_QTDE_AF}" readonly="true" rendered="#{pesquisaProgrEntregaItensAFController.isSc()}" value="#{pesquisaProgrEntregaItensAFController.qtdeAf}" size="10"/>  
              <mec:inputNumero id="vlrAf" value="#{pesquisaProgrEntregaItensAFController.valorAf}" label="#{messages.LABEL_VALOR}" required="false" inteiros="11" decimais="2" styleClass="mascara(decimal)" rendered="#{not pesquisaProgrEntregaItensAFController.isSc()}" actionBean="#{pesquisaProgrEntregaItensAFController}" style="text-align:right;" readonly="true}"/>  
              <mec:inputNumero id="qtdeProgramada" label="#{messages.LABEL_QTDE_PROG_AF}" readonly="true" rendered="#{pesquisaProgrEntregaItensAFController.isSc()}" value="#{pesquisaProgrEntregaItensAFController.qtdeProgramada}" size="10"/>  
              <mec:inputNumero id="vlrProgramado" value="#{pesquisaProgrEntregaItensAFController.valorProgramado}" label="#{messages.LABEL_VALOR_PROGRAMADO_AF}" required="false" inteiros="11" decimais="2" styleClass="mascara(decimal)" rendered="#{not pesquisaProgrEntregaItensAFController.isSc()}" actionBean="#{pesquisaProgrEntregaItensAFController}" style="text-align:right;" readonly="true}"/>  
              <mec:inputNumero id="qtdeLiberar" label="#{messages.LABEL_QTDE_LIB_AF}" readonly="true" rendered="#{pesquisaProgrEntregaItensAFController.isSc()}" value="#{pesquisaProgrEntregaItensAFController.qtdeLiberar}" size="10"/>  
              <mec:inputNumero id="vlrLiberar" value="#{pesquisaProgrEntregaItensAFController.valorLiberar}" label="#{messages.LABEL_VALOR_A_LIBERAR_AF}" required="false" inteiros="11" decimais="2" styleClass="mascara(decimal)" rendered="#{not pesquisaProgrEntregaItensAFController.isSc()}" actionBean="#{pesquisaProgrEntregaItensAFController}" style="text-align:right;" readonly="true}"/>  
              <mec:inputNumero id="qtdeEfetivada" label="#{messages.LABEL_QTDE_EFET_AF}" readonly="true" rendered="#{pesquisaProgrEntregaItensAFController.isSc()}" value="#{pesquisaProgrEntregaItensAFController.qtdeEfetivada}" size="10"/>  
              <mec:inputNumero id="vlrEfetivado" value="#{pesquisaProgrEntregaItensAFController.valorEfetivado}" label="#{messages.LABEL_VALOR_EFETIVADO_AF}" required="false" inteiros="11" decimais="2" styleClass="mascara(decimal)" rendered="#{not pesquisaProgrEntregaItensAFController.isSc()}" actionBean="#{pesquisaProgrEntregaItensAFController}" style="text-align:right;" readonly="true}"/> 
            </aghu:linha> 
          </aghu:panelGeral>
          <aghu:acao> 
            <mec:commandButton id="bt_novo" value="#{messages.LABEL_NOVO}" action="#{pesquisaProgrEntregaItensAFController.redirecionarProgEntregaItensAF}" rendered="#{not pesquisaProgrEntregaItensAFController.itemAfFechado}" disabled="#{not pesquisaProgrEntregaItensAFController.hasPermissionToLiberarParcelas()}" profile="add"> 
              <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroAf}" value="#{pesquisaProgrEntregaItensAFController.numeroAf}" for="command"/>  
              <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroItem}" value="#{pesquisaProgrEntregaItensAFController.numeroItem}" for="command"/>  
              <f:setPropertyActionListener target="#{progrEntregaItensAfController.voltarParaUrl}" value="compras-pesquisarProgEntregaItensAF" for="command"/> 
            </mec:commandButton>  
            <mec:commandButton id="bt_voltar" immediate="true" action="#{pesquisaProgrEntregaItensAFController.voltar}" value="#{messages.LABEL_VOLTAR}" styleClass="bt_cinza" profile="back"/> 
          </aghu:acao>
           
          <br/>
                   
          <mec:serverDataTable id="tabela_parcelas_itens_af" list="#{pesquisaProgrEntregaItensAFController.listaParcelas}"> 
            <c:set var="_item" value="#{item}"/>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_ACAO}"/> 
              </f:facet>  
              <mec:commandLink id="editarLink" title="#{messages.LABEL_EDITAR}" rendered="#{mf:hasPermission(securityController,'liberarParcelasAF,gravar')}" action="#{pesquisaProgrEntregaItensAFController.redirecionarProgEntregaItensAF}" profile="edit"> 
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.voltarParaUrl}" value="compras-pesquisarProgEntregaItensAF" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroAf}" value="#{_item.id.iafAfnNumero}" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroItem}" value="#{_item.id.iafNumero}" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroSeq}" value="#{_item.id.seq}" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroParcela}" value="#{_item.id.parcela}" for="command"/> 
              </mec:commandLink>  
              <mec:commandLink id="visualizarLink" title="#{messages.LABEL_VISUALIZAR}" rendered="#{not mf:hasPermission(securityController,'liberarParcelasAF,gravar') and mf:hasPermission(securityController,'consultarParcelasAF,visualizar')}" action="#{pesquisaProgrEntregaItensAFController.redirecionarProgEntregaItensAF}" styleClass=" silk-zoom silk-icon"> 
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.voltarParaUrl}" value="compras-pesquisarProgEntregaItensAF" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroAf}" value="#{_item.id.iafAfnNumero}" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroItem}" value="#{_item.id.iafNumero}" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroSeq}" value="#{_item.id.seq}" for="command"/>  
                <f:setPropertyActionListener target="#{progrEntregaItensAfController.numeroParcela}" value="#{_item.id.parcela}" for="command"/> 
              </mec:commandLink>  
              <mec:commandLink id="deleteButton" action="#{pesquisaProgrEntregaItensAFController.excluir()}" title="#{messages.LABEL_EXCLUIR}" rendered="#{mf:hasPermission(securityController,'liberarParcelasAF,gravar') and not pesquisaProgrEntregaItensAFController.itemAfGeradoAutomaticamente}" profile="delete" ajax="true" render="@form">
              	<f:setPropertyActionListener target="#{pesquisaProgrEntregaItensAFController.itemExclusao}" value="#{_item}" for="command"/>
              </mec:commandLink>  
              <mec:commandLink id="liberarAssinaturaLink" title="#{messages.LABEL_LIBERAR_ASSINATURA_AF}" rendered="#{mf:hasPermission(securityController,'liberarParcelasAF,gravar') and (not _item.indPlanejamento)}" action="#{pesquisaProgrEntregaItensAFController.liberarAssinatura(_item)}" styleClass="silk-incluir-enc-propostas-parecer-tecnico silk-icon" /> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PARCELA_AF}"/> 
              </f:facet>  
              <h:outputText value="#{_item.id.parcela}" style="float:right; "/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_NRO_AFP}"/> 
              </f:facet>  
              <h:outputText value="#{_item.scoAfPedido.id.numero}"/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PREVISAO_ENTREGA_PARCELA}"/> 
              </f:facet>  
              <h:outputText value="#{_item.dtPrevEntrega}"> 
                <f:convertDateTime pattern="dd/MM/yyyy"/> 
              </h:outputText> 
            </p:column>  
            <p:column> 
              <f:facet name="header">
              	<h:outputText value="#{messages.LABEL_GRID_PLANEJADA}" title="#{messages.MESSAGE_HINT_PLANEJADA}"/> 
              </f:facet>
              <p:outputPanel id="panelPlan">  
              	<h:graphicImage value="/resources/img/accept.png" rendered="#{_item.indPlanejamento}"/>
              </p:outputPanel>	  
              <p:tooltip for="panelPlan" direction="top-right" layout="block" rendered="#{_item.indPlanejamento}"> 
                <h:outputText value="#{messages.LABEL_DATA_LIBERCAO_PARCELA_AF}: "/>  
                <h:outputText value="#{_item.dtLibPlanejamento}"> 
                  <f:convertDateTime pattern="dd/MM/yyyy"/> 
                </h:outputText> 
              </p:tooltip> 
            </p:column>  
            <p:column> 
              <f:facet name="header">
              	<h:outputText value="#{messages.LABEL_GRID_ASSINADA}" title="#{messages.MESSAGE_HINT_ASSINADA}" /> 
              </f:facet>
              <p:outputPanel id="panelAccept">  
	              <h:graphicImage value="/resources/img/accept.png" rendered="#{_item.indAssinatura}"/>
              </p:outputPanel>  
              <p:tooltip for="panelAccept" rendered="#{_item.indAssinatura}"> 
                <h:outputText value="#{messages.MESSAGE_HINT_ASSINATURA} "/>  
                <h:outputText value="#{_item.dtAssinatura}"> 
                  <f:convertDateTime pattern="dd/MM/yyyy"/> 
                </h:outputText> 
              </p:tooltip> 
            </p:column>  
            <p:column rendered="#{pesquisaProgrEntregaItensAFController.isSc()}"> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_QTDE_LIBERADA}"/> 
              </f:facet>
              <p:outputPanel id="panelQtd">  
              	<h:outputText value="#{_item.qtde}" style="float:right; "/>
              </p:outputPanel>  
              <p:tooltip for="panelQtd" style="width:300px; word-wrap: break-word;" styleClass="tooltip"> 
                <h:outputText value="#{pesquisaProgrEntregaItensAFController.obterHintQtdLiberada(_item)}"/> 
              </p:tooltip> 
            </p:column>  
            <p:column rendered="#{pesquisaProgrEntregaItensAFController.isSc()}"> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_GRID_QTDE_ENTREGUE}"/> 
              </f:facet>  
              <h:outputText value="#{_item.qtdeEntregue}" style="float:right; "/> 
            </p:column>  
            <p:column rendered="#{pesquisaProgrEntregaItensAFController.isSc()}" style="text-align:right;#{pesquisaProgrEntregaItensAFController.getQtdeRp(_item).mostrarAlerta and pesquisaProgrEntregaItensAFController.getQtdeRp(_item).quantidade &gt; 0 ? 'background:#'.concat(qtdeItemNotaRecebProvisorioController.corDestaque).concat(' !important') : ''}"> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQ_GRID_ITENS_AUT_QTDE_RP}"/> 
              </f:facet>
              <h:outputText id="qtdRep" value="#{pesquisaProgrEntregaItensAFController.getQtdeRp(_item).quantidade}" />
                
               <p:tooltip for="qtdRep" style="width:300px;word-wrap:break-word;" direction="bottom-right" styleClass="tooltip" layout="block"> 
                
                <h:outputText value="#{messages.TOOLTIP_PESQ_GRID_ITENS_AUT_RP_PENDENTE_CONF}"/>  
                <br clear="none"/>  
                <h:outputText value="#{qtdeItemNotaRecebProvisorioController.getRps(pesquisaProgrEntregaItensAFController.getQtdeRp(_item))}" escape="false"/> 
              </p:tooltip> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{pesquisaProgrEntregaItensAFController.isSc() ? messages.LABEL_VLR_TOTAL_PARCELA : messages.LABEL_GRID_VALOR_LIBERADO}"/> 
              </f:facet>
              <p:outputPanel id="panelVlrTotal">  
	              <h:outputText value="#{_item.valorTotal}" style="float:right; "> 
	                <f:convertNumber pattern="###,##0.00"/> 
	              </h:outputText>
              </p:outputPanel>  
              <p:tooltip for="panelVlrTotal"> 
                <h:outputText value="#{messages.LABEL_VALOR_UNITARIO}: "/>  
                <h:outputText value="#{_item.scoItensAutorizacaoForn.valorUnitario}"> 
                  <f:convertNumber pattern="###,##0.0000"/> 
                </h:outputText> 
              </p:tooltip> 
            </p:column>  
            <p:column rendered="#{not pesquisaProgrEntregaItensAFController.isSc()}"> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_GRID_VALOR_EFETIVADO}"/> 
              </f:facet>  
              <h:outputText value="#{_item.valorEfetivado}" style="float:right; "> 
                <f:convertNumber pattern="###,##0.00"/> 
              </h:outputText> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_GRID_DATA_CANC}"/> 
              </f:facet>  
              <p:outputPanel id="panelDtCanc">
	              <h:outputText value="#{_item.dtCancelamento}"> 
	                <f:convertDateTime pattern="dd/MM/yyyy"/> 
	              </h:outputText>
              </p:outputPanel>  
              <p:tooltip for="panelDtCanc" rendered="#{_item.dtCancelamento != null}" style="width:300px;                                         word-wrap: break-word;" styleClass="tooltip"> 
                <h:outputText value="#{_item.rapServidorCancelamento.id.matricula} / #{_item.rapServidorCancelamento.id.vinCodigo} - #{_item.rapServidorCancelamento.pessoaFisica.nome}"/>  
                <br clear="none"/>  
                <h:outputText rendered="#{pesquisaProgrEntregaItensAFController.tipoSolicitacao eq 'SC'}" value="#{messages.LABEL_MARCA}: #{_item.scoItensAutorizacaoForn.marcaComercial.getDescricao()} "/> 
              </p:tooltip> 
            </p:column> 
          </mec:serverDataTable> 
        </h:form>  
    </ui:define> 
  </ui:composition> 
</html>
