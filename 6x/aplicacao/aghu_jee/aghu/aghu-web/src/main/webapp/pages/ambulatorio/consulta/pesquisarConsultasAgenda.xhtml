<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition template="/WEB-INF/templates/form_template.xhtml"> 
    <ui:define name="head"> 
      <title>#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA} :: #{messages.NOME_ABREVIADO_PROJETO}</title> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{consultaAgendaPaginatorController.iniciar}"/> 
      </f:metadata> 
    </ui:define>  
    <ui:define name="body"> 
      <mec:pageConfig controller="#{consultaAgendaPaginatorController}"/>  
      <h:form prependId="false" id="formPesquisa">
        <aghu:panelGeral legend="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA}"> 
          <p:outputPanel layout="block" id="formPrincipal" style="width:100%; position: relative;"> 
            <aghu:linha> 
              <mec:suggestionBox label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_SERVICO}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_SERVICO}" descricaoInput="codigo" descricaoLabel="descricao" width="400" suggestionAction="obterServico" id="servico" controller="#{consultaAgendaPaginatorController}" value="#{consultaAgendaPaginatorController.servico}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_CODIGO}</b> 
                  </f:facet> #{item.codigo}
                </p:column>
                <p:column>
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_DESCRICAO}</b>
                  </f:facet> #{item.descricao}
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:inputNumero readonly="false" label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_SEQGRADE}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_SEQGRADE}" size="6" maxlength="6" value="#{consultaAgendaPaginatorController.grdSeq}" id="seq">
              	<p:ajax   event="blur" process="@this"/> 
              </mec:inputNumero> 
              <mec:suggestionBox label="#{consultaAgendaPaginatorController.labelZona}" title="#{consultaAgendaPaginatorController.titleZona}" suggestionAction="obterZona" width="400" descricaoInput="sigla" descricaoLabel="descricao" id="zona" controller="#{consultaAgendaPaginatorController}" value="#{consultaAgendaPaginatorController.siglaUnfSalaVO}"> 
                <p:column>
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_ZONA}</b> 
                  </f:facet> #{item.sigla}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_DESCRICAO}</b> 
                  </f:facet> #{item.descricao}
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:suggestionBox label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_ESPECIALIDADE_AGENDA}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_ESPECIALIDADE_AGENDA}" descricaoInput="sigla" descricaoLabel="nomeEspecialidade" suggestionAction="obterEspecialidade" width="400" id="especialidade" controller="#{consultaAgendaPaginatorController}" value="#{consultaAgendaPaginatorController.especialidade}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_SIGLA}</b> 
                  </f:facet> #{item.sigla}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_ESPECIALIDADE_AGENDA}</b> 
                  </f:facet> #{item.nomeEspecialidade}
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:suggestionBox label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_EQUIPE}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_EQUIPE}" descricaoInput="seq" width="400" descricaoLabel="nome" suggestionAction="obterEquipe" id="equipe" controller="#{consultaAgendaPaginatorController}" value="#{consultaAgendaPaginatorController.equipe}"> 
                <p:column> 
                  <f:facet name="header">
                    <b>#{messages.LABEL_SEQ}</b> 
                  </f:facet> #{item.seq}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_EQUIPE}</b> 
                  </f:facet> #{item.nome}
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:suggestionBox label="#{messages.LABEL_PESQUISAR_PACIENTES_AGENDADOS_PROFISSIONAL}" title="#{messages.TITLE_PESQUISAR_PACIENTES_AGENDADOS_PROFISSIONAL}" descricaoInput="id.matricula" size="10" maxlength="10" width="400" descricaoLabel="pessoaFisica.nome" suggestionAction="obterProfissionais" id="profissional" controller="#{consultaAgendaPaginatorController}" value="#{consultaAgendaPaginatorController.profissional}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_VINCULO}</b> 
                  </f:facet>  
                  <h:outputText value="#{item.id.vinCodigo}"/> 
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_MATRICULA}</b> 
                  </f:facet>  
                  <h:outputText value="#{item.id.matricula}"/> 
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_NOME}</b> 
                  </f:facet>  
                  <h:outputText value="#{item.pessoaFisica.nome}"/> 
                </p:column> 
              </mec:suggestionBox> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:selectOneMenu label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_PAGADOR}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_PAGADOR}" noSelectionOption="true" value="#{consultaAgendaPaginatorController.pagador}" items="#{consultaAgendaPaginatorController.obterPagadoresComAgendamento()}" itemsType="entity" itemLabel="descricao" id="pagadorRenderer"/>  
              <mec:selectOneMenu label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_AUTORIZACAO}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_AUTORIZACAO}" noSelectionOption="true" value="#{consultaAgendaPaginatorController.autorizacao}" items="#{consultaAgendaPaginatorController.obterAutorizacoesAtivas()}" itemLabel="descricao" id="autorizacaoRenderer"/>  
              <mec:selectOneMenu label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_CONDICAO}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_CONDICAO}" noSelectionOption="true" value="#{consultaAgendaPaginatorController.condicao}" items="#{consultaAgendaPaginatorController.obterCondicaoAtentimentoAtivas()}" itemLabel="descricao" id="condicaoRenderer"/> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:suggestionBox label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_SITUACAO}"
					title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_SITUACAO}"
					descricaoInput="situacao"
					width="550"
					maxlength="25"
					descricaoLabel="descricao"
					suggestionAction="obterSituacao"
					id="situacao"
					controller="#{consultaAgendaPaginatorController}"
					value="#{consultaAgendaPaginatorController.situacao}">
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_DESCRICAO}</b> 
                  </f:facet> #{item.descricao}
                </p:column> 
              </mec:suggestionBox>  
              <mec:suggestionBox label="#{messages.LABEL_SITUACAO_ATENDIMENTO}" 
	              title="#{messages.TITLE_SITUACAO_ATENDIMENTO}" 
	              descricaoInput="seq"
	              width="400" 
	              descricaoLabel="descricao" 
	              suggestionAction="obterListaRetornosAtivos" 
	              id="retorno" 
	              controller="#{consultaAgendaPaginatorController}" 
	              value="#{consultaAgendaPaginatorController.retorno}"> 
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_SEQ}</b> 
                  </f:facet> #{item.seq}
                </p:column>  
                <p:column> 
                  <f:facet name="header"> 
                    <b>#{messages.LABEL_DESCRICAO}</b> 
                  </f:facet> #{item.descricao}
                </p:column> 
              </mec:suggestionBox> 
              
              <!-- <mec:suggestionBox 
              cache="false" 
              label="#{messages.LABEL_MANTER_GRADE_AGENDAMENTO_PROCEDIMENTO}" 
              title="#{messages.TITLE_INFORMAR_PROCEDIMENTOS}" 
              descricaoLimite="11"
              descricaoInput="descricao" 
              width="400" 
              descricaoLabel="descricao" 
              suggestionAction="obterProcedimentosSuggest" 
              id="procedimento" 
              controller="#{consultaAgendaPaginatorController}" 
              value="#{consultaAgendaPaginatorController.procedimento}" > 
                <p:column> 
                	#{item.descricao}
                </p:column>  
              </mec:suggestionBox>  -->
              
            </aghu:linha>  
            <p:outputPanel layout="block" style="width:36%;position:absolute;top:0%;right:2%;padding:10px" styleClass="aghu-panel-geral"> 
              <aghu:panelGeral legend="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_CONSULTAS_PERIODO}"> 
                <aghu:linha> 
                  <mec:selectOneMenu label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_DIA}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_DIA}" noSelectionOption="true" ajaxValidation="false" value="#{consultaAgendaPaginatorController.diaSemana}" enum="br.gov.mec.aghu.core.dominio.DominioDiaSemana" id="diaSemana"/>  
                  <mec:inputText label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_HORARIO}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_HORARIO}" incluirMascaraHora="true" size="5" maxlength="5" ajaxValidation="false" datePattern="HH:mm" dateType="time" removerCaratersEspeciais="false" value="#{consultaAgendaPaginatorController.horaConsulta}" id="horarios"/> 
                </aghu:linha>  
                <aghu:linha> 
                  <mec:inputTextData label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_DATAINICIAL}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_DATAINICIAL}" size="10" maxlength="10" required="true" value="#{consultaAgendaPaginatorController.dtInicio}" id="dtInicio" tipo="data"/>  
                  <mec:inputTextData label="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_DATAFINAL}" title="#{messages.TITLE_PESQUISAR_CONSULTAS_AGENDA_DATAFINAL}" size="10" maxlength="10" value="#{consultaAgendaPaginatorController.dtFim}" id="dtFim" tipo="data"/> 
                </aghu:linha> 
              </aghu:panelGeral> 
            </p:outputPanel> 
          </p:outputPanel> 
        </aghu:panelGeral>  
        <aghu:acao> 
            <mec:commandButton id="bt_pesquisar" value="#{messages.LABEL_PRE_VISUALIZAR}" action="#{consultaAgendaPaginatorController.pesquisar}" profile="ok"/>
			<p:commandButton id="bt_gerarArquivo"
				value="#{messages.LABEL_GERAR_ARQUIVO}"
				disabled="#{!mf:hasPermission(securityController,'gerarArquivoConsultasAgenda,gerar')}"
				actionListener="#{consultaAgendaPaginatorController.gerarArquivo}"
				ajax="false"
				onclick="PrimeFaces.monitorDownload(function(){PF('loadDialogWG').show();}, function(){PF('loadDialogWG').hide();});"
				styleClass="bt_cinza button-acao"	
				icon="icon-download-csv">
				<p:fileDownload value="#{consultaAgendaPaginatorController.streamedContent}" />
			</p:commandButton>
			<p:commandButton id="bt_carregarArquivoRass"
				value="#{messages.LABEL_CARREGAR_ARQUIVO_RASS}"
				disabled="#{!mf:hasPermission(securityController,'gerarArquivoConsultasAgenda,gerar')}"
				actionListener="#{consultaAgendaPaginatorController.carregarArquivoRAAS}"
				ajax="false"
				styleClass="bt_cinza button-acao">
		  	</p:commandButton>
			 <p:commandButton id="bt_gerarArquivoRass"
				value="#{messages.LABEL_GERAR_ARQUIVO_RASS}"
				disabled="#{!mf:hasPermission(securityController,'gerarArquivoConsultasAgenda,gerar')}"
				actionListener="#{consultaAgendaPaginatorController.gerarArquivoRASS}"
				ajax="false"
				onclick="PrimeFaces.monitorDownload(function(){PF('loadDialogWG').show();}, function(){PF('loadDialogWG').hide();});"
				styleClass="bt_cinza button-acao"
				icon="icon-download-csv">
				<p:fileDownload value="#{consultaAgendaPaginatorController.streamedContent}" />
		  	</p:commandButton>
		  	<p:commandButton id="bt_carregarArquivoEsus"
				value="#{messages.LABEL_CARREGAR_ARQUIVO_ESUS}"
				disabled="#{!mf:hasPermission(securityController,'gerarArquivoConsultasAgenda,gerar')}"
				actionListener="#{consultaAgendaPaginatorController.carregarArquivoEsus}"
				ajax="false"
				styleClass="bt_cinza button-acao">
		  	</p:commandButton>
			 <p:commandButton id="bt_gerarArquivoEsus"
				value="#{messages.LABEL_GERAR_ARQUIVO_ESUS}"
				disabled="#{!mf:hasPermission(securityController,'gerarArquivoConsultasAgenda,gerar')}"
				actionListener="#{consultaAgendaPaginatorController.gerarArquivoEsus}"
				ajax="false"
				onclick="PrimeFaces.monitorDownload(function(){PF('loadDialogWG').show();}, function(){PF('loadDialogWG').hide();});"
				styleClass="bt_cinza button-acao"
				icon="icon-download-zip">
				<p:fileDownload value="#{consultaAgendaPaginatorController.streamedContent}" />
		  	</p:commandButton>
		  	<p:commandButton id="bt_gerarArquivoInconsistenciasEsus"
				value="#{messages.LABEL_VISUALIZAR_INCONS_ESUS}"
				disabled="#{!mf:hasPermission(securityController,'gerarArquivoConsultasAgenda,gerar')}"
				actionListener="#{consultaAgendaPaginatorController.gerarArquivoInconsistenciasEsus}"
				ajax="false"
				onclick="PrimeFaces.monitorDownload(function(){PF('loadDialogWG').show();}, function(){PF('loadDialogWG').hide();});"
				styleClass="bt_cinza button-acao"
				icon="icon-download-csv">
				<p:fileDownload value="#{consultaAgendaPaginatorController.streamedContent}" />
		  	</p:commandButton>
		  	
		  	<mec:commandButton id="bt_limpar" value="#{messages.LABEL_LIMPAR}" action="#{consultaAgendaPaginatorController.limparPesquisa}" ajax="true" render="formPrincipal,panelTabelaConsultasAgenda" process="@this" styleClass="bt_cinza" profile="clear"/> 
        </aghu:acao>  
        <pe:remoteCommand name="selecionar"> 
          <pe:assignableParam name="param1" assignTo="#{consultaAgendaPaginatorController.seqSelected}"/> 
        </pe:remoteCommand> 
      </h:form>  
      <h:form prependId="false"> 
        <p:outputPanel id="panelTabelaConsultasAgenda" layout="inline"> 
          <mec:serverDataTable dataModel="dataModel" value="#{consultaAgendaPaginatorController}" style="font-size:9px!important" id="tabelaConsultasAgenda" controller="#{consultaAgendaPaginatorController}"> 
            <c:set var="row" value="#{item}"/>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_ESPECIALIDADE_AGENDA}"/> 
              </f:facet> 
              <p:outputPanel id="panelEspecialidadeSigla" layout="block"> 
              	<h:outputText value="#{row.especialidadeSigla}"/>  
              </p:outputPanel>
              <p:tooltip for="panelEspecialidadeSigla" trackMouse="true"> 
                <h:outputText value="#{row.especialidadeNome}"/> 
              </p:tooltip> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_SEQGRADE}"/> 
              </f:facet>  
              <h:outputText value="#{row.gradeAgendamentoSeq} "/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_MANTER_HORARIO_CONSULTA_DATA_HORA}"/> 
              </f:facet>  
              <h:outputText value="#{row.dataConsulta}"> 
                <f:convertDateTime pattern="dd/MM/yyyy HH:mm"/> 
              </h:outputText> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_CONDICAO}"/> 
              </f:facet>  
              <h:outputText value="#{row.condicaoAtendimentoDescricao}"/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_SITUACAO}"/> 
              </f:facet>  
              <h:outputText value="#{row.situcaoConsultaDescricao}"/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_PRONTUARIO}"/> 
              </f:facet>  
              <h:outputText value="#{row.pacienteProntuario}"/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_PACIENTE}"/> 
              </f:facet>  
              <h:outputText value="#{row.pacienteNome}"/> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_RETORNO}"/> 
              </f:facet>  
              <p:outputPanel id="panelRetornoSeq" layout="block"> 
              	<h:outputText value="#{row.retornoSeq}"/> 
              </p:outputPanel> 
              <p:tooltip for="panelRetornoSeq" trackMouse="true"> 
                <h:outputText value="#{row.retornoDescricao}"/> 
              </p:tooltip> 
            </p:column>  
            <p:column> 
              <f:facet name="header"> 
                <h:outputText value="#{messages.LABEL_PESQUISAR_CONSULTAS_AGENDA_CIDADE}"/> 
              </f:facet>  
              <h:outputText value="#{row.cidadeUf}"/> 
            </p:column> 
          </mec:serverDataTable> 
        </p:outputPanel> 
      </h:form>  
      <p:outputPanel id="panelModalConfirmacaoMaxRegistros" layout="inline"> 
        <p:dialog id="modalConfirmacaoMaxRegistros" width="400" height="150" modal="true" resizable="false" widgetVar="modalConfirmacaoMaxRegistrosWG"> 
          <f:facet name="header"> 
            <h:panelGroup> 
              <h:outputText value="#{messages.LABEL_CONFIRMAR_MAX_REGISTROS}"/> 
            </h:panelGroup> 
          </f:facet>  
          <br clear="none"/> #{messages.MENSAGEM_CONFIRMACAO_MAX_REGISTROS} 
          <br clear="none"/>  
          <br clear="none"/>  
          <h:panelGroup> 
            <h:form prependId="false" id="formModalConfirmacaoMaxRegistros" name="formModalConfirmacaoMaxRegistros"> 
              <mec:commandButton value="#{messages.LABEL_SIM}" block="true" id="bt_comfirmacaoMaxRegistros" action="#{consultaAgendaPaginatorController.gerarArquivo}" render="formPesquisa" profile="ok" ajax="true"/>  
              <mec:commandButton value="#{messages.LABEL_NAO}" oncomplete="PF('modalConfirmacaoMaxRegistrosWG').hide();" id="bt_cancelar_confirmacaoMaxRegistros" action="#{consultaAgendaPaginatorController.ocultarModalConfirmacaoMaxRegistros}" profile="cancel" ajax="true" process="@this"/> 
            </h:form> 
          </h:panelGroup> 
        </p:dialog> 
      </p:outputPanel> 
    </ui:define> 
  </ui:composition> 
</html>
