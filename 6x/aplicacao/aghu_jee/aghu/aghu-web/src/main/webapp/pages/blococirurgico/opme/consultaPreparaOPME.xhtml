<?xml version="1.0" encoding="UTF-8"?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fn="http://xmlns.jcp.org/jsp/jstl/functions" xmlns:mec="http://xmlns.jcp.org/jsf/composite/components" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:aghu="http://xmlns.jcp.org/jsf/component" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core" xmlns:mf="http://www.mec.gov.br/taglib">  
  <ui:composition template="/WEB-INF/templates/form_template.xhtml"> 
    <ui:define name="head"> 
      <title>#{messages.TITLE_CONS_PREP_OPME_PROC_CIRG_REQ_OPME}</title> 
    </ui:define>  
    <ui:define name="metadata"> 
      <f:metadata> 
        <f:viewAction action="#{consultaPreparaOPMEController.inicio}"/> 
      </f:metadata> 
    </ui:define>  
    <ui:define name="body"> 
      <mec:pageConfig controller="#{consultaPreparaOPMEController}"/>  
      <p:outputPanel id="panelPrincipal" layout="inline"> 
        <h:form prependId="false" id="formConsultaPreparaOPME"> 
          <aghu:panelGeral legend="#{messages.TITLE_CONS_PREP_OPME_PROC_CIRG_REQ_OPME}"> 
            <aghu:linha> 
              <mec:inputTextData id="idDataRequisicao" 
              		label="#{messages.LABEL_CONS_PREP_OPME_DT_REQ}" 
              		readonly="true" value="#{consultaPreparaOPMEController.vo.dataRequisicao}" 
              		tipo="data"/>  
              <mec:inputText id="idNomeRequerente" 
              		value="#{consultaPreparaOPMEController.vo.nomeRequerente}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_REQ}" 
              		maxlength="50" 
              		size="50" 
              		readonly="true"/>  
              <mec:inputText id="idEspecialidade" 
              		value="#{consultaPreparaOPMEController.vo.nomeEspecialidade}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_ESP}" 
              		maxlength="45" 
              		size="45" 
              		readonly="true"/>  
              <mec:inputText id="idProcedimentoPrincipal" 
              		value="#{consultaPreparaOPMEController.vo.procedimentoPrincipal}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_PROD_PRIC}" 
              		maxlength="80" 
              		size="80" 
              		readonly="true"/>  
              <mec:inputText id="idProcedimentoSUS" 
              		value="#{consultaPreparaOPMEController.vo.codTabela} - #{consultaPreparaOPMEController.vo.procedimentoSUS}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_PROD_SUS}" 
              		maxlength="80" 
              		size="80" 
              		readonly="true"/> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:inputTextData id="idDataProcedimento" 
              		label="#{messages.LABEL_CONS_PREP_OPME_DT_PROD}" 
              		readonly="true" 
              		value="#{consultaPreparaOPMEController.vo.dataProcedimento}" 
              		tipo="data"/>  
              <mec:inputText id="idAgenda" 
              		value="#{consultaPreparaOPMEController.vo.agenda}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_AGENDA}" 
              		maxlength="4" 
              		size="4" 
              		readonly="true"/>  
              <mec:inputText id="idUnidade" 
              		value="#{consultaPreparaOPMEController.vo.unidade}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_UNIDADE}" 
              		maxlength="4" 
              		size="4" 
              		readonly="true"/>  
              <mec:inputText id="idEquipe" 
              		value="#{consultaPreparaOPMEController.vo.equipe}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_EQUIPE}" 
              		maxlength="50" 
              		size="50" 
              		readonly="true"/>  
              <mec:inputText id="idNomePaciente" 
              		value="#{consultaPreparaOPMEController.vo.nomePaciente}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_PACIENTE}" 
              		maxlength="50" 
              		size="50" 
              		readonly="true"/>  
              <mec:inputText id="idProtuario" 
              		value="#{consultaPreparaOPMEController.vo.strProntuario}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_PRONT}" 
              		maxlength="8" 
              		size="8" 
              		readonly="true"/> 
            </aghu:linha>  
            <aghu:linha> 
              <mec:inputTextArea id="idObsGeraisRequerente" 
              		cols="132" 
              		rows="5" 
              		label="#{messages.LABEL_CONS_PREP_OPME_OBS_REQ}" 
              		size="2000" 
              		value="#{consultaPreparaOPMEController.vo.observacoesGerais}" 
              		removerCaratersEspeciais="false" 
              		readonly="true"/> 
            </aghu:linha>  
            <br clear="none"/>  
            <aghu:acao style="margin-top:14px !important;"> 
              <mec:commandButton id="btVisualisarAutorizacao" 
              		value="#{messages.LABEL_CONS_PREP_OPME_VISU_AUTO}" 
              		block="true" 
              		action="#{consultaPreparaOPMEController.visualizarAutorizacao}" 
              		styleClass=" icon-see-print bt_cinza"
              		disabled="#{consultaPreparaOPMEController.vo.indAutorizado eq null || !consultaPreparaOPMEController.vo.indAutorizado}">
              		<f:setPropertyActionListener target="#{visualizarAutorizacaoOpmeController.seqRequisicao}" value="#{consultaPreparaOPMEController.requisicaoSeqSelecionada}" for="command" />
              		<f:setPropertyActionListener target="#{visualizarAutorizacaoOpmeController.voltarParaUrl}" value="blococirurgico-consultaPreparaOPME" for="command" />
              </mec:commandButton>	  
              <mec:commandButton id="btConsultarHist" 
              		value="#{messages.LABEL_CONS_PREP_OPME_CONS_HIST}" 
              		action="#{consultaPreparaOPMEController.consultarHistorico}" 
              		styleClass=" silk-clock alinha-direita bt_cinza" 
              		ajax="true" 
              		render="panelModalConsultarHistoricoProcesso" 
              		process="@this"
              		disabled="#{consultaPreparaOPMEController.prepararOpme.fluxoSeq eq null}" > 
                <f:setPropertyActionListener target="#{acompanharProcessoAutorizacaoOPMsController.requisicaoSeqSelecionada}" value="#{consultaPreparaOPMEController.requisicaoSeqSelecionada}" for="command"/> 
              </mec:commandButton> 
            </aghu:acao> 
          </aghu:panelGeral>  
          <aghu:panelGeral legend="#{messages.LABEL_CONS_PREP_OPME_LIST_MAT_PROC}"> 
            <aghu:linha> 
              <mec:selectOneMenu id="idLicitado" 
              		enum="DominioSimNao" 
              		value="#{consultaPreparaOPMEController.filtroVO.licitado}" 
              		label="#{messages.LABEL_CONS_PREP_OPME_LICITADO}"/>  
              <mec:commandButton id="bt_pesquisar" 
              		style="margin-top:14px !important; margin-left:5px !important;" 
              		value="#{messages.LABEL_PESQUISAR}" 
              		block="true" 
              		action="#{consultaPreparaOPMEController.pesquisar}" 
              		profile="search"/> 
            </aghu:linha>  
            <aghu:linha> 
              <ui:fragment rendered="#{empty consultaPreparaOPMEController.listMateriaisProcedimentos and consultaPreparaOPMEController.pesquisar}"> 
                <br clear="none"/>  
                <div class="div-alerta"> 
                  <h:outputText value="#{messages.MSG_ERRO_CONS_MATS}"/> 
                </div> 
              </ui:fragment>  
              <ui:fragment rendered="#{consultaPreparaOPMEController.pesquisar}"> 
                <p:outputPanel id="idTabelaRetornoOperadora" style="width:99%; max-height:300px;overflow-y:auto; margin-left:4px !important; margin-right:4px !important; margin-top:10px !important;" layout="inline"> 
                  <mec:serverDataTable id="idDataTable" 
                  		styleClass="tbl_docs no-line-break"
                  		style="#{background}"
                  		list="#{consultaPreparaOPMEController.listMateriaisProcedimentos}"
                  		scrollable="true"
                  		selection="itemSelecionadoTable"
	           			controller="#{consultaPreparaOPMEController}"> 
                    <c:set var="_item" value="#{item}"/>  
                    <p:column style="width: 5%;" sortable="false"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_ACAO}"/> 
                      </f:facet>  
                      <h:commandLink
									rendered="#{_item.anexoOrcamento != null}" 
									title="#{messages.TITLE_DOWNLOAD_DOCUMENTO}"
									actionListener="#{consultaPreparaOPMEController.download(_item)}"
									styleClass="silk-icon silk-attach"/>
                      <mec:commandLink id="idSolicitarCompraMaterial" 
                      		title="#{messages.TITLE_CONS_PREP_OPME_SOLIC_COMPRA_MAT}" 
                      		action="#{consultaPreparaOPMEController.abreModalSolicitarCompraMaterial(_item)}" 
                      		styleClass=" silk-cart silk-icon"
                      		rendered="#{_item.requerido == 'NOV' and _item.slcNumero == null}"
                      		render="modalSolicitacaoCompra">
                        <f:setPropertyActionListener target="#{consultaPreparaOPMEController.matProcdOPMESelecionado}" value="#{_item}" for="command"/>
                      </mec:commandLink> 
                      <mec:commandLink rendered="#{mf:hasPermission(securityController,'consultarSolicitacaoCompras,visualizar') and _item.slcNumero != null}" 
                      				   action="#{consultaPreparaOPMEController.redirecionarSolicitacaoCompra}"
                      				   style="padding-left:5px;"
                      				   value="#{_item.slcNumero}"
                      				   title="#{messages.TITLE_SOLICITACAO_MATERIAL_VISU}"> 
                    	<f:setPropertyActionListener target="#{solicitacaoCompraController.numero}" value="#{_item.slcNumero}" for="command"/>  
                    	<f:setPropertyActionListener target="#{solicitacaoCompraController.voltarParaUrl}" value="blococirurgico-consultaPreparaOPME" for="command"/>  
                    	
                  	  </mec:commandLink> 
                    </p:column>  
                    <p:column id="idItemMaterialSUS" 
                    	sortable="false" 
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA; font-weight: bold;'}; text-align: center; "> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_COLUMN_SIGTAP}" />
                      </f:facet>  
                      <h:outputText value="#{_item.codTabela}" />
                    </p:column>  
                    <p:column id="idItemLicitado" 
                    	sortable="false"
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA; font-weight: bold;'}; text-align: center; width: 7%;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONS_PREP_OPME_LICITADO}" />
                      </f:facet>  
                      <h:outputText value="#{_item.licitado}"/> 
                    </p:column>  
                    <p:column id="idItemQtdeAut" 
                    	sortable="false"
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA; font-weight: bold;'}; text-align: center; width: 7%;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONS_PREP_OPME_QTD_AUT}" />
                      </f:facet>  
                      <h:outputText value="#{_item.qtdeAut}"/> 
                    </p:column>  
                    <p:column id="idItemVlUni" 
                    	sortable="false"
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA; font-weight: bold;'}; text-align: right;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONS_PREP_OPME_VL_UNI}"/> 
                      </f:facet>  
                      <h:outputText value="#{_item.valorUnitario}"> 
                        <f:convertNumber pattern="###,##0.00"/> 
                      </h:outputText> 
                    </p:column>  
                    <p:column id="idItemVlTot" 
                    	sortable="false"
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA; font-weight: bold;'}; text-align: right;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONS_PREP_OPME_VL_TOT}"/> 
                      </f:facet>  
                      <h:outputText value="#{_item.valorTotal}"> 
                        <f:convertNumber pattern="###,##0.00"/> 
                      </h:outputText> 
                    </p:column>  
                    <p:column id="idItemMatlHosp" 
                    	sortable="false"
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA'}; width: 25%;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_CONS_PREP_OPME_MAT_HOSP}"/> 
                      </f:facet>  
                      <h:outputText value="#{_item.materialHosp}"/> 
                    </p:column> 
                    <p:column id="idItemMatlQtd" 
                    	sortable="false" 
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA'}; text-align: center;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_COLUMN_QTDE_SOL}"/> 
                      </f:facet>  
                      <h:outputText value="#{_item.quantidadeSolicitada}"/> 
                    </p:column>
                    <p:column id="idItemUndMed" 
                    	sortable="false" 
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA'}; text-align: center;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_COLUMN_UNIDADE_MEDIDA}"/> 
                      </f:facet>  
                      <h:outputText value="#{_item.unidadeMedidaCodigo}" />
                    </p:column>
                    <p:column id="idItemMatlMarca" 
                    	sortable="false" 
                    	style="#{empty _item.codTabela  ? ' ' : 'background-color:#EEE8AA'}; text-align: center;"> 
                      <f:facet name="header"> 
                        <h:outputText value="#{messages.LABEL_COLUMN_MARCA}"/> 
                      </f:facet>  
                      <h:outputText value="#{_item.materialMarca}" />
                    </p:column>
                  </mec:serverDataTable> 
                </p:outputPanel> 
              </ui:fragment> 
            </aghu:linha> 
          </aghu:panelGeral>  
          <aghu:acao> 
            <mec:commandButton id="bt_voltar" 
            	value="#{messages.LABEL_VOLTAR}" 
            	action="#{consultaPreparaOPMEController.voltar}" 
            	styleClass=" alinha-direita bt_cinza" 
            	profile="back"/> 
          </aghu:acao> 
        </h:form> 
      </p:outputPanel>
      <h:form prependId="false"> 
        <p:outputPanel layout="inline" id="panelModalConsultarHistoricoProcesso"> 
          <ui:decorate template="/pages/blococirurgico/modalConsultarHistoricoProcessoPreparo.xhtml"/> 
        </p:outputPanel> 
      </h:form>
      <p:dialog id="modalSolicitacaoCompra" width="400" height="150" modal="true" resizable="false" widgetVar="modalSolicitacaoCompraWG"> 
        <f:facet name="header"> 
          <h:panelGroup> 
            <h:outputText value="#{messages.TITLE_MSG_CONS_PREP_OPME_MODAL}"/> 
          </h:panelGroup> 
        </f:facet> #{messages.LABEL_MSG_CONS_PREP_OPME_MODAL} 
        <br clear="none"/>  
        <br clear="none"/>  
        <br clear="none"/>  
        <h:panelGroup> 
          <h:form prependId="false" id="formModalSolicitacaoCompra"> 
            <mec:commandButton id="excluir" 
            	value="#{messages.LABEL_SIM}" 
            	block="true" 
            	action="#{consultaPreparaOPMEController.solicitarCompraMaterial}"
            	profile="search"/>  
            <mec:commandButton id="cancelarExclusao" 
            	value="#{messages.LABEL_NAO}" 
            	onclick="PF('modalSolicitacaoCompraWG').hide();; return false;" 
            	profile="cancel" 
            	ajax="true"/> 
          </h:form> 
        </h:panelGroup> 
      </p:dialog>
      <p:dialog id="modalTelaConsultaSolicCompra" width="400" height="150" modal="true" resizable="false" widgetVar="modalTelaConsultaSolicCompraWG"> 
        <f:facet name="header"> 
          <h:panelGroup> 
            <h:outputText value="#{messages.TITLE_MSG_CONS_PREP_OPME_MODAL}" />
          </h:panelGroup> 
        </f:facet> #{messages.LABEL_MSG_TELA_CONSULTA_SOLIC_COMPRA}
        <br clear="none"/>  
        <br clear="none"/>  
        <br clear="none"/>  
        <h:panelGroup> 
          <h:form prependId="false" id="formModalTelaConsultaSolicCompra"> 
            <mec:commandButton id="ir_para_tela_sim"
            	value="#{messages.LABEL_SIM}" 
            	block="true" 
            	action="#{consultaPreparaOPMEController.redirecionarSolicitarCompraCRUD}" 
            	profile="search">
              <f:setPropertyActionListener target="#{solicitacaoCompraController.numero}" value="#{consultaPreparaOPMEController.scoSolicitacaoDeCompra.numero}" for="command"/>
              <f:setPropertyActionListener target="#{solicitacaoCompraController.voltarParaUrl}" value="blococirurgico-consultarPreparaOPME" for="command"/>
            </mec:commandButton>  
            <mec:commandButton id="cancelarExclusao_ir_para_tela"
            	value="#{messages.LABEL_NAO}" 
            	onclick="PF('modalTelaConsultaSolicCompra').hide();; return false;" 
            	profile="cancel" 
            	ajax="true"/> 
          </h:form> 
        </h:panelGroup> 
      </p:dialog> 
    </ui:define> 
  </ui:composition> 
</html>
